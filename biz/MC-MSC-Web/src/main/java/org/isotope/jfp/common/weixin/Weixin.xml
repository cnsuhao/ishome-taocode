<?xml version='1.0' encoding='UTF-8' ?> 
<!DOCTYPE mapper
    PUBLIC '-//mybatis.org//DTD Dao 3.0//EN' 
    'http://mybatis.org/dtd/mybatis-3-mapper.dtd' >
<!-- 角色功能权限 --> 
<!-- 需要和DAO保持完全路径一致 -->
<mapper namespace='org.isotope.jfp.common.weixin.WeixinDao'>

    <!-- 企业信息  -->
    <select id='loadCompany' parameterType='java.util.Map' resultType='WeiXinCompanyDBO'>
        SELECT * FROM school_weixin
        WHERE is_use = 1 
        	<if test=" companyId != null and companyId !='' "><!-- 学校id -->
            	AND sid = #{companyId}
	        </if>
	        <if test=" appId != null and appId !='' "><!-- 应用ID -->
	            AND app_id = #{appId}
	        </if>
    </select>
    
    <select id='loadCompanyGroup' parameterType='java.util.Map' resultType='WeiXinCompanyGroupDBO'>
        SELECT * FROM school_weixin_group
        WHERE is_use = 1 
        	<if test=" companyId != null and companyId !='' "><!-- 学校id -->
            	AND sid = #{companyId}
	        </if>
	        <if test=" groupId != null and groupId !='' "><!-- 用户组ID -->
	            AND gid = #{groupId}
	        </if>
	        <if test=" wxId != null and wxId !='' "><!-- 微信ID -->
	            AND wx_id = #{wxId}
	        </if>
	        <if test=" wxIdIsNull != null and wxIdIsNull !='' "><!-- 微信ID -->
	            AND (wx_id is null OR wx_id='')
	        </if>
    </select>
    
    <!-- 查询用户组用户 -->
    <select id='loadCompanyGroupUser' parameterType='java.util.Map' resultType='WeiXinCompanyGroupUserDBO'>
        SELECT u.* FROM school_weixin_user u,school_weixin_group g,
        WHERE u.is_use = 1 AND u.sid = g.sid AND u.gid = g.gid ADN u.uid = g.uid
        	<if test=" companyId != null and companyId !='' "><!-- 学校id -->
            	AND g.sid = #{companyId}
	        </if>
	        <if test=" groupId != null and groupId !='' "><!-- 用户组ID -->
	            AND g.gid = #{groupId}
	        </if>
    </select>
    
    <select id='loadCompanyUser' parameterType='java.util.Map' resultType='WeiXinCompanyGroupUserDBO'>
        SELECT * FROM school_weixin_user
        WHERE is_use = 1 
        	<if test=" companyId != null and companyId !='' "><!-- 学校id -->
            	AND sid = #{companyId}
	        </if>
	        <if test=" appId != null and appId !='' "><!-- 用户ID -->
	            AND uid = #{userId}
	        </if>
	        <if test=" wxId != null and wxId !='' "><!-- 微信ID -->
	            AND wx_id = #{wxId}
	        </if>
	        <if test=" wxIdIsNull != null and wxIdIsNull !='' "><!-- 微信ID -->
	            AND (wx_id is null OR wx_id='')
	        </if>
    </select>

	<!-- 更新企业用户组微信ID -->
    <update id='updateCompanyGroupById' parameterType='WeiXinCompanyGroupDBO'>
        UPDATE school_weixin_group SET wx_id = #{wxId} WHERE sid = #{companyId} AND gid = #{groupId}
    </update>
    
    <!-- 更新企业用户微信ID -->
    <update id='updateCompanyUserById' parameterType='WeiXinCompanyGroupUserDBO'>
        UPDATE school_weixin_user SET wx_id = #{wxId} WHERE sid = #{companyId} AND uid = #{userId}
    </update>
</mapper>
