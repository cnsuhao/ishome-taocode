[toc]

## 5 课表页面接口调用说明

@(千校云)

> 标签： 接口文档 后台

---
### 文档更新说明
> 更新时间：2016-07-29

### 页面说明
 > 课表录入页面为课表录入页面，输入区域包括：学年选择框，班级选择框，以及课表输入表格和课程选择按钮（课程选择按钮下方可以选择配置任课教师）
 
 > 课表显示页面为课表查询页面，输入区域包括：学期选择框、学年选择框、班级选择框，和课程选择按钮，当进入编辑状态后，课表表格由只读查询状态变为编辑状态，可以添加课程点击保存后变成查看状态；

### 5.1 班级课表查询
#### 5.1.1 学校学期年级班级查询接口（通用）
>详见
>9 系统设置
>9.3 班级设定页面接口
>9.3.1学校学期年级班级查询接口（通用）

#### 5.1.2 班级课表查询接口
>班级课表查询接口可获取课程表，包含课表的班级、年级、学期已经作息时间模板和具体事项；
>仅返回所有有效的学期和年级标签；
>课程表中的课程与作息规则中规则数量保持一致，如果没有数据保留位置为空，对应关系为第一规则对应第一个课程教师，第二个规则对应第二个课程教师，课程教师可以不填（代表这个规则不上课）；
>需要token验证权限
```json
Url:        /qxy/syllabus/term=[term_id]&grade=[grade_id]&class=[cid]&week=[week]&teacher=[tid]&token=[token]
Method:     GET
Header:     Content-type:application/json
Parameter:
    - 'term':    查询的学期id，如果不传则默认获取当前缺省学期
    - 'grade':   年级id
    - 'class':   班级id
    - 'week':    周数如2，为前端根据学期数计算出的周数
    - 'teacher': 教师id，不传则获取全部教师课表，如果传tid则获取某教师课表
    - 'token':   token
Response:
    - `status`：  0->token is OK 
                10->token is invalid
                12->token is timeout
                13->Illegal interface calls, not power use nterface
    - `term_name`:     学期名字
    - `grade_name`:    年级
    - `class_name`:    班级名称
    - `week`:          周数
    - `work_name`:     作息模板名称
    - `wrule_name`:    作息模板规则名称
    - `wrule_stage`:   模板规则阶段#＃0-早晨1-上午2-中午3-下午4-傍晚5-夜间
    - `start_time`:    规则开始时间24小时制，如07:00
    - `end_time`:      规则结束时间24小时制，如16:00
    - `syllabus`:      课程表json
    - `date`:          日期，如2016-8-1
    - `courseteacher`: 课程教师
    - `course_name`:   课程名称
    - `teacher_name`:  教师姓名
```

> **返回结果示例：**
``` json
{
    "status": 0,
    "data":{
        "count":"5",
        "term_name":"2016-2017-2",
        "grade_name":"高一",
        "class_name":"一班",
        "week":"5",
        "work_id":"14",
        "work_name":"小学夏季专用",
        "work_rule":[
			{
				"wrule_id":"1",
				"wrule_name":"早自习一",
				"wrule_stage": "1",
				"start_time": "07:00",
				"end_time": "08:00"
			},
			{
				"wrule_id":"2",
				"wrule_name":"早自习二",
				"wrule_stage": "1",
				"start_time": "08:00",
				"end_time": "09:00"
			},
			{
				"wrule_id":"3",
				"wrule_name":"上午一",
				"wrule_stage": "1",
				"start_time": "07:00",
				"end_time": "08:00"
			},
			{
				"wrule_id":"4",
				"wrule_name":"上午二",
				"wrule_stage": "1",
				"start_time": "08:00",
				"end_time": "09:00"
			}
		],
        "syllabus":[
			 {
				 "date":"1470069023",
				 "courseteacher":[
				     {
					     "course_id1":"1",
					     "course_name1":"语文",
					     "tid1":"14",
					     "teacher_name1":"张三"
				     },
				     {
					     "course_id2":"2",
					     "course_name2":"语文",
					     "tid2":"14",
					     "teacher_name2":"张三"
				     },
				     {
					     "course_id3":"3",
					     "course_name3":"语文",
					     "tid3":"14",
					     "teacher_name3":"张三"
				     },
				     {
					     "course_id4":"",
					     "course_name4":"",
					     "tid4":"",
					     "teacher_name4":""
				     }
				 ]
			 },
			 {
				 "date":"1470269023",
				 "courseteacher":[
				     {
					     "course_id":"1",
					     "course_name1":"语文",
					     "tid1":"14",
					     "teacher_name1":"张三"
				     },
				     {
					     "course_id2":"2",
					     "course_name2":"语文",
					     "tid2":"14",
					     "teacher_name2":"张三"
				     },
				     {
					     "course_id3":"1",
					     "course_name3":"语文",
					     "tid3":"14",
					     "teacher_name3":"张三"
				     },
				     {
					     "course_id4":"2",
					     "course_name4":"语文",
					     "tid4":"14",
					     "teacher_name4":"张三"
				     }
				 ]
			 }
         ]
    }
}
```



#### 5.1.3 课程教师查询接口
>详见
>4 班级管理
>4.2 班级课程页面接口
>4.2.1 班级课程查询接口

### 5.2 选择课程教师
#### 5.2.1 教工标签查询接口
>详见
>7 校通讯录管理
>7.1 教工管理页面接口
>7.1.1 教工标签查询接口

#### 5.2.2 教工列表查询接口
>详见
>7 校通讯录管理
>7.1 教工管理页面接口
>7.1.2 教工列表查询接口

#### 5.2.3 课程教师指定接口
>详见
>4 班级管理
>4.2 班级课程页面接口
>4.2.5 班级课程教师指定接口

#### 5.2.4 课程教师修改接口
>详见
>4 班级管理
>4.2 班级课程页面接口
>4.2.6 班级课程教师修改接口

### 5.3 班级课表编辑
#### 5.3.1 班级课表新增接口
>班级课表新增接口可新增特定班级的课程；
>课程表中的课程按照一个星期的数据来展现，每天的课程数量根据班级作息模板来确定；
>需要token验证权限
```json
Url:        /qxy/syllabus
Method:     POST
Header:     Content-type:application/json
Parameter:  
    - 'token':         token
    - `term_id`:       学期id
    - `cid`:           班级id
    - `week`:          周数
    - `syllabus`:      课程表json
    - `date`:          日期，如2016-8-1
    - `courseteacher`: 课程教师json
    - `course_id`:     课程id
    - `tid`:           教师id
示例：
{	
    "token":"fcc277636dea80d3d298df9465795a875e6eb9df",	
	"term_id":"1",
	"cid":"12",
	"week":"1",
	"syllabus":[
		{
			"date":"1470069023",
			"courseteacher":[
				{
				     "course_id1":"1",
				     "course_name1":"语文",
				     "tid1":"14",
				     "teacher_name1":"张三"
			     },
			     {
				     "course_id2":"2",
				     "course_name2":"语文",
				     "tid2":"14",
				     "teacher_name2":"张三"
			     },
			     {
				     "course_id3":"3",
				     "course_name3":"语文",
				     "tid3":"14",
				     "teacher_name3":"张三"
			     },
			     {
				     "course_id4":"",
				     "course_name4":"",
				     "tid4":"",
				     "teacher_name4":""
			     }
			]
		},
		{
			"date":"1470099023",
			"courseteacher":[
				{
				     "course_id1":"1",
				     "course_name1":"语文",
				     "tid1":"14",
				     "teacher_name1":"张三"
			     },
			     {
				     "course_id2":"2",
				     "course_name2":"语文",
				     "tid2":"14",
				     "teacher_name2":"张三"
			     },
			     {
				     "course_id3":"3",
				     "course_name3":"语文",
				     "tid3":"14",
				     "teacher_name3":"张三"
			     },
			     {
				     "course_id4":"",
				     "course_name4":"",
				     "tid4":"",
				     "teacher_name4":""
			     }
			]
		}
	]
}
Response:
    - `status`：  0->OK 
                1-> 新增失败，班级不存在
                2-> 新增失败，课程不存在
                10->token is invalid
                12->token is timeout
                13->Illegal interface calls, not power use nterface
> **返回结果示例：**
```
``` json
{
    "status": "0",
    "info": "OK"
}
```

#### 5.3.2 班级课表修改及删除接口
>班级课表修改及删除接口可修改及删除特定班级的特定课程；
>课程表中的课程按照一个星期的数据来展现，每天的课程数量根据班级作息模板来确定；
>需要token验证权限
```json
Url:        /qxy/syllabus
Method:     PUT
Header:     Content-type:application/json
Parameter:  
    - 'token':         token
    - `term_id`:       学期id
    - `cid`:           班级id
    - `week`:          周次
    - `syllabus`:      课程表json
    - `date`:          日期，如14800001000
    - `courseteacher`: 课程教师json
    - `course_id`:     课程id
    - `tid`:           教师id
示例：
{	
    "token":"fcc277636dea80d3d298df9465795a875e6eb9df",	
	"term_id":"1",
	"cid":"12",
	"week":"1",
	"syllabus":[
		{
			"id":"1",                #某天的课表id
			"date":"1470069023",
			"courseteacher":[
				{
				     "course_id1":"1",
				     "course_name1":"语文",
				     "tid1":"14",
				     "teacher_name1":"张三"
			     },
			     {
				     "course_id2":"2",
				     "course_name2":"语文",
				     "tid2":"14",
				     "teacher_name2":"张三"
			     },
			     {
				     "course_id3":"3",
				     "course_name3":"语文",
				     "tid3":"14",
				     "teacher_name3":"张三"
			     },
			     {
				     "course_id4":"",
				     "course_name4":"",
				     "tid4":"",
				     "teacher_name4":""
			     }
			]
		},
		{
			"id":"2",                #某天的课表id
			"date":"1470099023",
			"courseteacher":[
				{
				     "course_id1":"1",
				     "course_name1":"语文",
				     "tid1":"14",
				     "teacher_name1":"张三"
			     },
			     {
				     "course_id2":"2",
				     "course_name2":"语文",
				     "tid2":"14",
				     "teacher_name2":"张三"
			     },
			     {
				     "course_id3":"3",
				     "course_name3":"语文",
				     "tid3":"14",
				     "teacher_name3":"张三"
			     },
			     {
				     "course_id4":"",
				     "course_name4":"",
				     "tid4":"",
				     "teacher_name4":""
			     }
			]
		}
	]
}
Response:
    - `status`：  0->OK 
                1-> 修改失败，班级不存在
                2-> 修改失败，课程不存在
                10->token is invalid
                12->token is timeout
                13->Illegal interface calls, not power use nterface
> **返回结果示例：**
```
``` json
{
    "status": "0",
    "info": "OK"
}
```


#### 5.3.3 班级课表应用到其他周接口
>班级课表应用至其他周接口可应用特定周的课表至其该班其他周；前端需要获取要应用到目标周的周次及包含的日期；
>课程表中的课程按照一个星期的数据来展现，每天的课程数量根据班级作息模板来确定；
>需要token验证权限
```json
Url:        /qxy/syllabus/copy
Method:     PUT
Header:     Content-type:application/json
Parameter:  
    - 'token':         token
    - `term_id`:       学期id
    - `cid`:           班级id
    - `week`:          周次
    - `sourceweek`:    课表源周次
    - `sourcesyllabus`：源周次课表json 
    - `mark`:          标记第几天
    - `courseteacher`: 标记该天中的课程教师json
    - `targetweeks`:   目标周json
    - `weekdays`:      目标周中的天json
    - `syllabus`:      课程表json
    - `course_id`:     课程id
    - `tid`:           教师id
示例：
{	
    "token":"fcc277636dea80d3d298df9465795a875e6eb9df",	
	"term_id":"1",
	"cid":"12",
	"sourceweek":"1",
	"sourcesyllabus":[
		{
			"mark":"1"
			"courseteacher":[
				{
				    "course_id1":"1",
				    "course_name1":"语文",
				    "tid1":"14",
				    "teacher_name1":"张三"
			    },
			    {
				    "course_id2":"2",
				    "course_name2":"语文",
				    "tid2":"14",
				    "teacher_name2":"张三"
			    },
			    {
				    "course_id3":"3",
				    "course_name3":"语文",
				    "tid3":"14",
				    "teacher_name3":"张三"
			    },
			    {
				    "course_id4":"",
				    "course_name4":"",
				    "tid4":"",
				    "teacher_name4":""
			    }
			] 
		},
		{
			"mark":"2"
			"courseteacher":[
				{
				    "course_id1":"1",
				    "course_name1":"语文",
				    "tid1":"14",
				    "teacher_name1":"张三"
			    },
			    {
				    "course_id2":"2",
				    "course_name2":"语文",
				    "tid2":"14",
				    "teacher_name2":"张三"
			    },
			    {
				    "course_id3":"3",
				    "course_name3":"语文",
				    "tid3":"14",
				    "teacher_name3":"张三"
			    },
			    {
				    "course_id4":"",
				    "course_name4":"",
				    "tid4":"",
				    "teacher_name4":""
			    }
			] 
		}
	],
	"targetweeks":[14800001000,14800002000]   #要应用到目标周的天
}
Response:
    - `status`：  0->OK 
                1-> 修改失败，班级不存在
                2-> 修改失败，课程不存在
                10->token is invalid
                12->token is timeout
                13->Illegal interface calls, not power use nterface
> **返回结果示例：**
```
``` json
{
    "status": "0",
    "info": "OK"
}
```

### 5.4 教师课表
#### 5.4.1 教师班级列表查询接口
>详见
>9 系统设置
>9.3 班级设定页面接口
>9.3.1学校学期年级班级查询接口（通用）
#### 5.4.2 教师课表查询接口
>详见
>5 课表页面接口调用说明
>5.1 班级课表查询
>5.1.2 班级课表查询接口



