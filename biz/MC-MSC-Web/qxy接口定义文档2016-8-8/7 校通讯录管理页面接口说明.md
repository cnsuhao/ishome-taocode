[toc]
## 7 校通讯录管理页面接口说明

@(千校云)


>标签： 接口 校通讯录

---
### 文档更新说明
> 更新时间：2016-08-01
> 更新说明：参照restfull规范定义

### 页面说明
> 校通讯录管理功能包括以下三个页面为校通讯录教工管理页面，以及教工信息新增（修改）页面，对应的教工标签管理页面（包括移动员工在不同标签中），命名为：教工管理，新增教工（修改教工），教工标签管理。

 > 教工管理页面为全校教工列表页面，或者选择的指定教工标签对应的员工列表，该页面有批量操作功能，可以实现员工移动到其他标签，（为简便操作，用户选择全部员工时，员工移动到其他标签为拷贝到其他标签，其他标签间移动则为剪切＋拷贝），或者停用（取消停用）指定的员工

 > 教工信息新增（修改）页面为弹出式窗口，可以选择直接提交关闭，也可以选择下一位直接提交当前信息后，重新录入下一位的教工数据（仅对新增员工弹出窗口有效）

> 教工标签管理页面为弹出式标签管理页面，只能新增标签。删除标签和修改标签直接在标签展示页面上通过鼠标点击后的弹出菜单完成。

### 7.1 教工管理页面接口
#### 7.1.1 教工标签查询接口
> 需要使用Token验证查询者身份
> 教工标签查询接口返回了当前学校的教工标签列表（注意：标签没有停用和启用功能）
```json
Url:        /qxy/label?token=[token]
Method:     GET
Header:     Content-type:application/json
Parameter:
    - 无 :   
Response:
    - `status`：     0->token is OK 
                    11->token is invalid
                    12->token is timeout
                    13->Illegal interface calls, not power use interface
    - `label`:    教工标签内容JSON
    - `count`:         教工标签总数
```
> 返回结果示例：
```
{
    "status": 0,
    "data": {
        "count":"3",
        "label": [
	        {
	            "labelId": "4",
	            "labelName": "教务一组"
	        },
	        {
	            "labelId": "2",
	            "labelName": "教研一组"
	        },
	        {
	            "labelId": "6",
	            "labelName": "教学一组"
	        }
	    ]
	}
}
```
#### 7.1.2 教工列表查询接口
> 教工列表查询接口返回了当前标签下的教工列表数据，当标签id＝0或者标签ID为空时，返回全部教工列表数据。本接口支持分页查询教工列表（注意：标签没有停用和启用功能）

>该接口为教工查询通用接口，type值会影响教工列表数据，0-仅有效教工，1-所有教工，缺省不传参数仅返回有效教工

> 2016-8-9:需要按照教工姓名首字母排序；liuchiqing

> 需要使用Token验证查询者身份

``` json
Url:        /qxy/teacher/list?labelId=[labelId]&type=[type]&page=[page]&size=[size]&token=[token]
Method:     GET
Header:     Content-type:application/json
Parameter:
    - `labelId`:    教工标签ID，为空返回全部教工,默认为0
    - `page` ：     page对应的分页编号数字，当page＝0或者page为空时，返回第一页
    - `size` ：     size对应的每页数据条数，当size＝0或者size为空时，默认一页返回12条
    - `type`:       type值会影响教工列表数据，0-仅有效教工，1-所有教工，缺省不传参数仅返回有效教工
    - `token` ：      token
Response:
    - `status`：     0->token is OK 
                    11->token is invalid
                    12->token is timeout
                    13->Illegal interface calls, not power use interface
    - `teacherlist`:    教工列表内容JSON
    - `count`:          教工列表总数
    - `page`:           当前的分页编号
    - `teacherName`:           教工姓名
    - `email`:          教工邮箱
    - `phone`:          教工电话
    - `isUse`:         是否启用0-停用，1-启用
    - `letter`:        字母
```
> **返回结果示例：**
```
{
    "status": 0,
    "data": {
        "page":"0",   #为0时返回的全部分页
        "size":"14",   #为0时默认返回每页12条
        "count":"3",
        "teacherlist": [
            {
				"tid": "4",
                "teacherName": "张山",
                "email": "zhangshan@qq.com",
                "phone": "13789343221",
                "isUse": "1"
            },
            {
                "tid": "5",
                "teacherName": "李四",
                "email": "lisi@qq.com",
                "phone": "13789343221",
                "isUse": "1"
            },
            {
                "tid": "6",
                "teacherName": "王五",
                "email": "wangshan@qq.com",
                "phone": "13789343221",
                "isUse": "0"
            }
        ]
    }
}
```

#### 7.1.3 教工搜索接口
> 需要使用Token验证查询者身份
>根据教工邮箱或手机号进行搜索，默认只能搜索全部标签下的教工，不传参数或为空的时候，不用进行搜索
>type为0是返回所有启用的教工，为1时返回所有教工包含停用和启用的；


``` json
Url:        /qxy/teacher/search?phone=[phone]&email=[email]&type=[type]&token=[token]
Method:     GET
Header:     Content-type:application/json
Parameter:
    - 'phone':        教工电话
    - 'email'：       教工邮箱
    - 'type':         0-有效的教工，1-所有教工，缺省不传参数仅返回有效教工
    - `token` ：      token
Response:
    - `status`：0->OK 
                1->要查找的教工不存在
                2->无权限查找
                11->token is invalid
                12->token is timeout
                13->Illegal interface calls, not power use interface
```
> **返回结果示例：**
```
{
    "status": 0,
    "data": {
        "tid":"0",   
        "teacherName":"张三",
        "phone":"15201232521",
        "email":"123@qq.com",   
        "isUse": "1"
    }
}
```


#### 7.1.4 教工移动到特定标签接口
> 移动指定标签下的教工到特定标签下接口处理教工在标签中的移动（修改对应的标示字段）（注意：停用的教工可以显示，但无法移动，也无法登陆的，登录接口需要联表查询教工表的是否启用的标示）

>移动教工至特定标签下，当源标签为0时，表示从全部教工标签（缺省标签）下拷贝用户到其他标签中；其余情况为移动标签，移动标签时需要判断该标签是否应和该用户关联；

> 需要使用Token验证查询者身份

``` json
Url:        /qxy/teacher/move?token=[token]
Method:     PUT
Header:     Content-type:application/json
Parameter:
    - 'labelId':    源标签的labelId，当源标签为0时，表示从全部教工标签（缺省标签）下拷贝用户到其他标签中；其余情况为移动标签
    - 'target'：      目标标签的labelId
    - 'tid'：       教工id
    - 'token'：       token
示例：
{
    "teacher":{
		"tid":"123",
		"labelId":"0",       
		"target":"12"         
	}
}
Response:
    - `status`：0->OK 
                1->无移动教工身份权限
                2->对应的tid教工身份无效
                3->对应的source无效
                4->对应的target无效
                11->token is invalid
                12->token is timeout
                13->Illegal interface calls, not power use interface
    - `count`:  教工身份修改成功的数量
```
> **返回结果示例：**

``` json
{
    "status": "0",
	"data":{
		"info":"ok"
	}
}
```


#### 7.1.5 移除指定标签下教工的接口
> 移除指定标签下的教工接口处理教工在标签中的移除（修改对应的关联关系表）（注意：停用的教工是可以显示的，但无法移动，也无法登陆的，登录接口需要联表查询教工表的是否启用的标示）

> 需要使用Token验证查询者身份

>当源标签的labelId为0时，不能移除

``` json
Url:        /qxy/teacher/remove?token=[token]
Method:     PUT
Header:     Content-type:application/json
Parameter:
    - 'labelId':       源标签的labelId，当源标签为0时，不能移除
    - 'token'：       token
示例：
{
    "teacher":{
		"tid":"123",
		"labelId":"12"
	}
}
Response:
    - `status`：0->token is OK 
                1->无权限移除教工身份
                2->对应的tid教工身份无效
                3->对应的sourceId无效，不能从labelId=0的标签中移除教工
                11->token is invalid
                12->token is timeout
                13->Illegal interface calls, not power use interface
    - `count`:  成功的数量
```
> **返回结果示例：**

``` json
{
    "status": "0",
	"data":{
		"info":"ok"
	}
}
```

### 7.2 教工信息管理接口
#### 7.2.1 教工信息查询接口

> 教工信息查询接口处理教工基础信息的查询功能（注意：停用的教工在教工特定标签列表中是可以显示，但无法移动，也无法登陆的，登录接口需要联表查询教工表的是否启用的标示）

> 需要使用Token验证查询者身份
``` json
Url:        /qxy/teacher/info?tid=[tid]&token=[token]
Method:     GET
Header:     Content-type:application/json
Parameter:
    - 'tid':      查询指定tid内容对应的教工详情
    - `token` ：      token
Response:
    - `status`：0->OK 
                1->无权限查询教工详细信息
                2->对应的tid教工身份无效 
                11->token is invalid
                12->token is timeout
                13->Illegal interface calls, not power use interface
    - `labellist`:教师标签json
```
> **返回结果示例：**

``` json
{
    "status": 0,
    "data":{
        "tid":"123",
        "teacherName":"张三",                        #姓名
        "gender":"1",                       #教师性别（0-男；1-女；2-保密；）
        "dateOfBirth":"2011/7/8 00:00:00",         #出生年月
        "startWorkT":"2011/7/8 00:00:00",       #开始工作时间
        "jobNumber":"0189302",             #工号
        "cardType":"1",                    #证件类型
        "cardNumber":"425222522223252112",  #证件号码
        "homeAddress":"斯里兰卡",              #家庭住址
        "phone":"1552325235",
        "email":"ee@ww.com",
        "isUse":"0",   ＃是否启用，0-停用 1-正常
		"isLeader":"1"       #是否为班主任 0-否，1-是
        "labellist":[
            {
                "labelId": "123"，
                “labelName":"教研一组"
            },
            {
                "labelId": "124",
                "labelName":"教研二组"
            }    
        ],
		"teacherinfo":[
            {
			    "courseId":"12",
			    "courseName":"语文"
            },
            {
			    "courseId":"13",
			    "courseName":"数学"
            }    
        ]
    }
}
```

#### 7.2.2 教工信息新增接口

> 教工信息新增接口处理教工基础信息的新增功能，教师手机号和邮箱为唯一标识符，新增前需要先检查查phone或email是否已经存在user表中，如果有就关联，如果没有就新增user再关联；
> 所有教工新增后会建立和默认标签的关联labelId=0,默认标签为全部标签，教工不可从其中移除出去，也就是新增教工的时候需要创建新的教工账号，并且需要维护教工和标签关联表中与labelId=0的关联

> 需要使用Token验证查询者身份

``` json
Url:        /qxy/teacher/info?token=[token]
Method:     POST
Header:     Content-type:application/json
Parameter:
    - 'token'：       token
    -'teacherName':          教师姓名
    -'gender':              #教师性别（0-男；1-女；2-保密；）
    -'dateOfBirth':         出生年月
    -'startWorkT':          工作时间
    -'jobNumber':            工号
    -'cardType':         证件类型
    -'cardNumber':     证件号码
    -'homeAddress':         家庭住址
    -'phone':               电话
    -'email': 	           邮箱
	
示例：
{
    "teacherName":"张三",
    "gender":"1",              
    "dateOfBirth":"2011/7/8 00:00:00",
    "startWorkT":"2011/7/8 00:00:00",
    "jobNumber":"0189302",
    "cardType":"1",
    "cardNumber":"425222522223252112",
    "homeAddress":"斯里兰卡",
    "phone":"1552325235",
    "email":"ee@ww.com",
}
Response:
    - `status`：0->OK 
                1->无权新增教工权限
                2->手机号或邮箱已经存在
                11->token is invalid
                12->token is timeout
                13->Illegal interface calls, not power use interface
```
> **返回结果示例：**

``` json
{
    "status": "0",
	"data":{
		"info":"ok"
	}
}
```
#### 7.2.3 教工信息修改\教工身份停用(启用)接口
> 停用（启用）指定的教工身份接口处理教工的停用和启用（修改对应的标示字段）（注意：停用的教工是无法登陆的，登录接口需要联表查询教工表的是否启用的标示）,可以批量停用教工；
> 不能批量修改教工
> 需要使用Token验证查询者身份

``` json
Url:        /qxy/teacher/info?token=[token]
Method:     PUT
Header:     Content-type:application/json
Parameter:
    - 'tid':          教工id
    - 'teacherName':          教师姓名
    - 'gender':              #教师性别（0-男；1-女；2-保密；）
    - 'dateOfBirth':         出生年月
    - 'startWorkT':          工作时间
    - 'jobNumber':            工号
    - 'cardType':         证件类型
    - 'cardNumber':     证件号码
    - 'homeAddress':         家庭住址
    - 'phone':               电话
    - 'email': 	           邮箱
    - 'token'：       token
示例：
{
    "teacherinfo":[
	    {
		    "tid":"123",
		    "teacherName":"张三",                        #姓名
		    "gender":"1",                       #教师性别（0-男；1-女；2-保密；）
		    "dateOfBirth":"2011/7/8 00:00:00",         #出生年月
		    "startWorkT":"2011/7/8 00:00:00",       #开始工作时间
		    "jobNumber":"0189302",             #工号
		    "cardType":"1",                    #证件类型
		    "cardNumber":"425222522223252112",  #证件号码
		    "homeAddress":"斯里兰卡",              #家庭住址
		    "phone":"1552325235",
		    "email":"ee@ww.com",
		    "isUse":"0",   ＃是否启用，0-停用 1-正常
	    }
    ]
    
}
Response:
    - `status`：0->token is OK 
                1->无权限修改教工身份
                2->对应的tid教工身份无效
                3->修改失败，邮箱或手机号已经存在
                11->token is invalid
                12->token is timeout
                13->Illegal interface calls, not power use interface
  
```
> **返回结果示例：**

``` json
{
    "status": "0",
	"data":{
		"info":"ok"
	}
}
```
#### 7.2.4 教工信息删除接口
> 删除教工基本信息接口（非删除标签关系）处理教工信息的删除（有关联关系时不容许用户删除教工基本信息。本操作需要放到缺省的全部教工标签下进行！）,支持批量删除操作（注意：停用的教工是可以显示的，但无法移动，也无法登陆的，登录接口需要联表查询教工表的是否启用的标示）,比如工作流程里面已经有该教师的流程事项，班级班主任，值日值周关联，课程表关联

> 需要使用Token验证查询者身份

``` json
Url:        /qxy/teacher?token=[token]
Method:     DELETE
Header:     Content-type:application/json
Parameter:
    - 'tid':          教工id
    - 'token'：       token
示例：
{
    "tid":"1"
}
Response:
    - `status`：0->token is OK 
                1->无权限删除教工身份
                2->对应的tid教工身份无效
                3->删除失败，该教工已经在其他地方使用（包括班级，包括教工标签等关联表中）
                11->token is invalid
                12->token is timeout
                13->Illegal interface calls, not power use interface
    - `count`:  教工删除成功的数量
```
> **返回结果示例：**

``` json
{
    "status": "0",
	"data":{
		"info":"ok"
	}
}
```
### 7.3 教工标签管理接口
#### 7.3.1 教工标签新增接口
> 教工标签新增接口处理教工标签的新增功能（注意：标签没有停用功能！）

> 需要使用Token验证查询者身份

``` json
Url:        /qxy/label?token=[token]
Method:     POST
Header:     Content-type:application/json
Parameter:
    - 'labelName'：       标签名称
    - 'token'：       token
示例：
{
    "labelName":"教研一组"
}
Response:
    - `status`：0->token is OK 
                1->无权限新增教工标签身份
                2->新增失败，标签名称重复
                11->token is invalid
                12->token is timeout
                13->Illegal interface calls, not power use interface
    - `count`:  教工删除成功的数量
```
> **返回结果示例：**

``` json
{
    "status": "0",
	"data":{
		"info":"ok"
	}
}
```


#### 7.3.2 教工标签修改接口

> 教工标签修改接口处理教工标签的修改功能（注意：标签没有停用功能！）

> 需要使用Token验证查询者身份


``` json
Url:        /qxy/label?token=[token]
Method:     PUT
Header:     Content-type:application/json
Parameter:
    - 'token'：       token
    - 'labelId'：    标签id
    - 'labelName':   标签名字
示例：
{
    "labelId":"123",
	"labelName":"教研一组"
}
Response:
    - `status`：0->token is OK 
                1->无权限修改教工标签身份
                2->修改失败，标签id无效
                11->token is invalid
                12->token is timeout
                13->Illegal interface calls, not power use interface
```
> **返回结果示例：**

``` json
{
    "status": "0",
	"data":{
		"info":"ok"
	}
}
```

#### 7.3.3 教工标签删除接口


> 教工标签删除接口处理教工标签的删除功能（注意：标签没有停用功能！）

> 需要使用Token验证查询者身份

``` json
Url:        /qxy/label?token=[token]
Method:     DELETE
Header:     Content-type:application/json
Parameter:
    - 'token'：       token
    - 'labelId'：    标签id
示例：
{
    "labelId":"123",
}
Response:
    - `status`：0->token is OK 
                1->无权限删除教工标签身份
                2->删除失败，标签id无效
                11->token is invalid
                12->token is timeout
                13->Illegal interface calls, not power use interface
```
> **返回结果示例：**

``` json
{
    "status": "0",
	"data":{
		"info":"ok"
	}
}
```
