
[TOC]

## 千校云接口文档更新说明
> 2016-7-29：重新整理学校管理模块接口文档；
> 2016-8-1：更新文档，参照restfull规范修改


## 6. 学校管理页面接口说明

@(千校云)


>标签 ： 接口 学校管理

---

### 文档更新说明
> 更新时间：2016-07-29

### 页面说明
 > 学校管理功能包括校历管理，学校基本信息设置及微信号设置三个页面，命名为：校历管理，学校设置，和微信绑定。其中学校设置和微信绑定页面功能需要在后期进一步完善（学校设置这里会加入管理员权限设置功能，可以学校配置管理员（特定教师）能使用的功能；微信设置则需要考虑绑定不同微信公众号的流程）
 
 > 校历管理页面通过选择不同的学期，展现了不同学期的每周的校历大事列表。在校历管理页面可以进入校历设置页面管理每个学期的设置情况，还可以进入每周的校历大事修改页面，对校历进行修改。

 > 学校设置页面设置了学校的基本信息，以后会加入学校教师管理页面设置，设置学校管理员能打开的页面

 > 微信设置页面暂时不考虑接口问题

### 6.1 校历管理页面接口
#### 6.1.1 学校学期及校历日历状态查询接口
>需要使用Token验证查询者身份；
>查询返回学校所有有效学期，缺省学期需同时返回校历有事项的日期区间，其他正常查看学期不需要返回该项；
``` json
Url:        /qxy/termcalendarstatus?token=[token]
Method:     GET
Header:     Content-type:application/json
Parameter:
    - 无
Response:
    - `status`:         0->OK 
                        10->token is invalid
                        12->token is timeout
                        13->Illegal interface calls, not power use interface
    - `calendarstatus`: 有校历事项的日期JSON，缺省学期才会返回，其他学期不需要返回
    - `count`:          校历内容的条目总数
    - `isDefault`:      是否为缺省学期，0-否，1-是； 
```

> **返回结果示例：**

``` json
{
    "status": 0,
    "data":{
        "count":"4",
        "termlist":[
		{
			"termId":"1",
			"termName":"2016-2017-1",
			"startTime":"2016-8-9",
			"endTime":"2016-8-9",
			"isDefault":"1",            #缺省学期
			"calendarstatus":[                
				{
                "startTime":"2016-8-9",   
                "endTime":"2016-8-9"   
	            },
	            {
                "startTime":"2016-8-9",   
                "endTime":"2016-8-9"   
	            }
			]
		},
		{
			"termId":"2",
			"termName":"2016-2017-2",
			"startTime":"2016-8-9",
			"endTime":"2016-8-9",
			"isDefault":"0"
		}
      ]
    }
}
```

#### 6.1.2 学校校历查询接口
> 学校校历查询接口用于查询指定学期中某周设置了哪些校历数据，本接口调用时需要传入学期编号和周开始结束时间，查找校事历中有重叠的事项全部返回，周校历内容条数有限，不考虑分页功能；

> 需要使用Token验证查询者身份

``` json
Url:        /qxy/calendar?termId=[termId]&startTime=[startTime]&endTime=[endTime]&token=[token]
Method:     GET
Header:     Content-type:application/json
Parameter:
    - `term`:         指定查询的学期id,为空时按缺省的学期id来查
    - 'startTime':     （周）开始时间    该参数为必填项
    - 'endTime':       （周）结束时间    该参数为必填项
    - `token` ：      token
Response:
    - `status`:       0->OK 
                      10->token is invalid
                      12->token is timeout
                      13->Illegal interface calls, not power use interface
    - `calendarinfo`: 校历内容JSON
    - `count`:        校历内容的条目总数
    - `calendarId`:  工作事项对应的id
```

> **返回结果示例：**

``` json
{
    "status": 0,
    "data":{
        "count":"2",
        "calendarinfo":[
            {
                "calendarId":"221",         #工作事项对应的id
                "content": "学校安全检查",   #校历内容
                "department":"校办公室",     #责任部门
                "time": {
                    "startTime": "2016-8-9",
                    "endTime": "2016-8-9"
                }
            },
            {
                "calendarId":"222",          #工作事项对应的id
                "content": "学校安全检查",    #校历内容
                "department":"校办公室",      #责任部门
                "time": {
                    "startTime": "2016-8-9",
                    "endTime": "2016-8-9"
               }
            }
        ]
    }
}
```

#### 6.1.3 学校校历新增接口
> 新增校历工作事项接口用于提交新增的校历工作事项，需要上传对应的学期和起止时间

> 需要使用Token验证查询者身份
``` json
Url:        /qxy/calendar
Method:     POST
Header:     Content-type:application/json
Parameter:
    - `termId`:         指定学期id
    - `startTime`:      开始时间
    - `endTime`:        结束时间
    - `content`:         校历内容
    - `department`:      责任部门
    - 'token'：          token
示例：
{
    "token":"fcc277636dea80d3d298df9465795a875e6eb9df"，
    "termId": "1",
    "startTime": "2016-8-9",  
    "endTime": "2016-8-9",
    "content": "学校安全检查",   #校历内容
    "department":"校办公室",   #责任部门
}
Response:
    - `status`:        0->OK 
                       1->term没有对应的学期数据可以修改
                       2->type不正确
                       10->token is invalid
                       12->token is timeout
                       13->Illegal interface calls, not power use interface
    - `calendarId`:   校历事项对应的id
```

> **返回结果示例：**

``` json
{
    "status": "0",
	"data":{
		"info":"ok"
	}
}
```

#### 6.1.4 学校校历修改接口
> 需要使用Token验证查询者身份
``` json
Url:        /qxy/calendar
Method:     PUT
Header:     Content-type:application/json
Parameter:
    - `calendarId`:   校历事项对应的id
    - `termId`:         指定学期id
    - `startTime`:      开始时间
    - `endTime`:        结束时间
    - `content`:         校历内容
    - `department`:      责任部门
    - 'token'：          token
示例：
{
    "calendarId":"12",
    "token":"fcc277636dea80d3d298df9465795a875e6eb9df"，
    "termId": "1",
    "startTime": "2016-8-9",  
    "endTime": "2016-8-9",
    "content": "学校安全检查",   #校历内容
    "department":"校办公室",   #责任部门
}
Response:
    - `status`:        0->OK 
                       1->term没有对应的学期数据可以修改
                       2->type不正确
                       10->token is invalid
                       12->token is timeout
                       13->Illegal interface calls, not power use interface
    - `calendarId`:   校历事项对应的id
```

> **返回结果示例：**

``` json
{
    "status": "0",
	"data":{
		"info":"ok"
	}
}
```

#### 6.1.5 学校校历删除接口
> 删除校历工作事项接口用于提交删除的校历工作事项

> 需要使用Token验证查询者身份
``` json
Url:        /qxy/calendar
Method:     DELETE
Header:     Content-type:application/json
Parameter:
    - `calendarId`:  校历事项对应的id
    - `token`:  token
示例：
{
    "token":"fcc277636dea80d3d298df9465795a875e6eb9df"，
    "calendarId":"12"
}
Response:
    - `status`: 0->OK 
                1->term没有对应的学期数据可以删除
                2->weekinfoId数据不正确
                10->token is invalid
                12->token is timeout
                13->Illegal interface calls, not power use interface
```

> **返回结果示例：**

``` json
{
    "status": "0",
	"data":{
		"info":"ok"
	}
}
```

### 6.2 学期设置页面接口
#### 6.2.1 学校学期查询接口
> 学期查询接口用于查询系统中设置的学期，每个学期的标识为"2016-2017-1"即2016-2017学年第一个学期（上学期，不直接注明上下学期是为了保证有多个学期 (>2)的情况。

>学期列表可以通过设置获取不同学期：0-获取有效的学期，1-获取所有学期，不传参数默认返回有效的学期

> 需要使用Token验证查询者身份

``` json
Url:        /qxy/term?type=[type]&token=[token]
Method:     GET
Header:     Content-type:application/json
Parameter:
	- `type` :   设置获取学期的类型：0-获取有效的学期，1-获取所有学期，不传参数默认返回有效的学期
    - `token` ：      token
Response:
	- `status`: 0->is OK 
				10->token is invalid
				12->token is timeout
				13->Illegal interface calls, not power use interface
	- `termlist`:     学期内容JSON
	- `now`:          当前学期
	- `count`:        学期总数
	- `isDefault`:   0-可查看学期；1-缺省设置学期
	- `isUse`:       0-停用；1-启用
```

> **返回结果示例：**

``` json
{
    "status": 0,
    "data":{
        "count":"2",
        "termlist": [
            {
                "termId": "11",
                "termName": "2016-2017-1",
                "isDefault":"0",   #0-可查看学期；1-缺省学期
                "isUse": "1",      #0-停用；1-启用
                "startTime": "2016-8-9",
                "endTime": "2016-8-9"
            },
            {
                "termId": "12",
                "termName": "2016-2017-2",
                "isDefault":"1",   #缺省学期
                "isUse": "1",     #启用
                "startTime": "2016-8-9",
                "endTime": "2016-8-9"
            },
            {
                "termId": "13",
                "termName": "2016-2017-3",
                "isDefault":"0",   #可查看学期
                "isUse": "0",     #停用
                "startTime": "2016-8-9",
                "endTime": "2016-8-9"
            },
        ]
    }
}
```

#### 6.2.2 学校学期新增接口
> 学校学期新增接口用于新增学期数据，指定了学期的起始日，学期的结束日和学期名称。默认添加的学期为启用状态；学期名称不能重复；

> 需要使用Token验证查询者身份
> 2016-8-9 liuchiqing:学期无法新增，提示404
``` json
Url:        /qxy/term
Method:     POST
Header:     Content-type:application/json
Parameter:
	- `termName`:       学期名称，xxxx-xxxx-1格式（注意：该字段数据库中不能重复）
	- `startTime`:      指定该学期的开始日
	- `endTime`:        指定该学期的结束日
	- 'token'：          token
示例：
{
    "token":"fcc277636dea80d3d298df9465795a875e6eb9df"，
    "termName": "2016-2017-1",
    "startTime": "2016-8-9",
    "endTime": "2016-8-9"
}
Response:
        - `status`: 0->OK
			        1->学期名已存在
			        2->暂无权限
                    10->token is invalid
                    12->token is timeout
                    13->Illegal interface calls, not power use interface
```

> **返回结果示例：**

``` json
{
    "status": "0",
	"data":{
		"info":"ok"
	}
}
```
#### 6.2.3 学校学期修改\停用(启用)\设为缺省学期接口
> 学校学期修改接口用于修改学期数据，默认初始化可由系统管理员来修改，系统使用后不能被修改；
> 学校学期数据停用（启用）接口用于设置是否停用学期数据，默认添加的学期为启用状态，可修改
 > 该接口用于设置缺省学期，缺省学期只能有一个，设置前需要检查一下是否已经存在缺省学期
> 需要使用Token验证查询者身份

``` json
Url:        /qxy/term
Method:     PUT
Header:     Content-type:application/json
Parameter:
    - `termId`:         学期id
    - `termName`:       学期名称，xxxx-xxxx-1格式（注意：该字段数据库中不能重复）
    - `startTime`:      指定该学期的开始日
    - `endTime`:        指定该学期的结束日
    - `isUse`:          是否启用,0-停用，1-启用
    - `isDefaule':    是否设为缺省学期，0-否；1-是
    - 'token'：          token
示例：
{
    "token":"fcc277636dea80d3d298df9465795a875e6eb9df",
    "termId": "1",
    "termName": "2016-2017-1",
    "startTime": "2016-8-9",
    "endTime": "2016-8-9",
    "isUse": "1",
    "isDefaule":"1"
}
Response:
        - `status`: 0->OK 
			        1->学期名已存在
			        2->暂无权限
                    10->token is invalid
                    12->token is timeout
                    13->Illegal interface calls, not power use interface
```

> **返回结果示例：**

``` json
{
    "status": "0",
	"data":{
		"info":"ok"
	}
}
```


#### 6.2.4 学校学期删除接口
> 学校学期删除接口用于删除学期数据

> 学校学期删除接口需要使用Token验证查询者身份

``` json
Url:        /qxy/term
Method:     DELETE
Header:     Content-type:application/json
Parameter:
    - 'termId':      指定学期id
    - 'token'：       token
示例：
{
    "token":"fcc277636dea80d3d298df9465795a875e6eb9df"，
    "termId": "1"
}
Response:
    - `status`: 0->OK 
                1->term没有对应的学期数据可以删除
                2->team已经被使用
                10->token is invalid
                12->token is timeout
                13->Illegal interface calls, not power use interface
```

> **返回结果示例：**

``` json
{
    "status": "0",
	"data":{
		"info":"ok"
	}
}
```












