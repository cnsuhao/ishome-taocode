 [toc]

## 2 校园新闻页面接口说明

@(千校云)

> 标签： 接口 校园新闻

---


### 文档更新说明
> 更新时间：2016-08-02

### 页面说明
> 包括以下三个页面：新闻列表页面，新闻修改和新闻新增页面，栏目设定管理页面，命名为：新闻管理，新增新闻（修改新闻），栏目管理。

> 新闻管理页面为用户全校新闻列表页面，输入区域包括：栏目筛选和新闻标题搜索，以及栏目置顶，审核，撤销，轮播，删除等设置，新闻列表页面具备分页功能

> 新增新闻（修改新闻）页面为提交新闻使用，也可用于新闻的修改

> 栏目管理页面为新闻栏目的列表管理页面，可以新增栏目，修改栏目，停用栏目

### 2.1 新闻管理页面接口
####2.1.1 新闻列表查询接口

> 新闻列表查询接口返回了当前的新闻列表，以时间倒序，显示指定时间内的新闻内容列表供管理员查看（注意：栏目设置为暂停的栏目下的新闻不可见，接口关联查询要加上）

> 新闻列表查询接口需要使用Token验证查询者身份

``` json
Url:        /qxy/news?columnId=[colId]&startTime=[startTime]&endTime=[endTime]&type=[type]&tid=[tid]&page=[page]&size=[size]&token=[token]
Method:     GET
Header:     Content-type:application/json
Parameter:
    - 'columnId': 指定搜索的栏目ID，无column参数或参数无效时返回全部数据
    - 'startTime':   指定查询的开始时间割   如不传，默认获取所有或者截止到结束时间的新闻
    - 'endTime':     指定查询的结束时间割   如不传，默认获取所有或者从开始时间发布的所有新闻
    - `page`:   分页编号，分页为0或者空时，返回全部数据
    - `size`:   每页数据条数，为0或空时，默认返回12条数据
    - `tid`:发布者教师tid，传参数可获取该教师发布的新闻
    - `type`:   新闻类型0-所有新闻，1-审核通过的，2-审核未通过,3-待审核新闻；不传则默认返回所有新闻
    - `token` ：      token
Response:
    - `status`：0->成功
                1->无效的栏目id
                11->token is invalid
                12->token is timeout
                13->Illegal interface calls, not power use interface
    - 'newslist':        新闻数据json
    - 'count':           当前返回新闻数据条数
    - 'allnews':         新闻总数
    - 'publishnews':     全部已发布新闻数据条数
```

> **返回结果示例：**

``` json
{
    "status": 0,
    "data": {
        "allnews":"70",
        "publishnews":"68", 
        "columnName":"栏目名称",                  #目的是显示在通过栏目筛选的位置
        "startTime":"2016-8-9 00:00:00",              #目的是显示在通过栏目筛选的位置
        "endTime":"2016-8-9 00:00:00",                #目的是显示在通过栏目筛选的位置
        "type":"1",                              #目的是显示在通过栏目筛选的位置
        "page":"2",
        "size":"12",
        "count":"20",
        "newslist":[
            {
                "newsId": "122",
                "title": "学校建设迈入新阶段",
                "isTop": "1",          #是不是置顶0-非置顶；1-置顶
                "isPic": "1",          #是不是包括图片0-不包括；1-包括
                "pic": "url",         
                "isAudit":"1",         #0-未审核，1-审核通过，2-审核驳回
                "isHomenews":"1",      #是否为首页轮播0-否，1-是
                "author": "212",        #作者发布人id（tid）
                "authorName": "张俪",   #作者名（对应teacherName）
                "columnId": "12",      #发布栏目id
                "columnName": "校园风采",   #发布栏目名(对应栏目title)
                "publishTime": "2016-8-9 00:00:00"   #发布时间
            },
            {
                "newsId": "123",
                "title": "学校建设迈入新阶段",
                "isTop": "1",          #是不是置顶0-非置顶；1-置顶
                "isPic": "1",          #是不是包括图片0-不包括；1-包括
                "pic": "url",         
                "isAudit":"1",         #0-未审核，1-审核通过，2-审核驳回
                "isHomenews":"1",      #是否为首页轮播0-否，1-是
                "author": "212",        #作者发布人id（tid）
                "authorName": "张俪",   #作者名（对应teacherName）
                "columnId": "12",      #发布栏目id
                "columnName": "校园风采",   #发布栏目名(对应栏目title)
                "publishTime": "2016-8-9 00:00:00"   #发布时间
            }
        ]
    }
}
```
####2.1.2 新闻详情查看接口
> 需要使用Token验证查询者身份
``` json
Url:        /qxy/news/detaile?newsId=[newId]&token=[token]
Method:     GET
Header:     Content-type:application/json
Parameter:
    - 'newsId'：       新闻id
    - `token` ：      token
Response:
    - `status`：0->is OK
                1->查看失败，无调用权利
                2->查看失败，无对应的newsId
               11->token is invalid
               12->token is timeout
               13->Illegal interface calls, not power use interface
    - 'newsId'：      新闻id    
    - 'title'：       新闻标题
    - 'content'：     新闻内容（base64编码）
    - 'columnId'：   发布栏目id
    - 'newsType'：   新闻的阅读范围 0-全部；1-仅教师；2-教师和家长
    - 'newsReader'： 新闻教师阅读范围，为空表示全部
    - 'newsClasser'：新闻班级阅读范围，为空表示全部
    - 'isTop'：      是否置顶0-否，1-是
    - 'publishTime': 发布时间
    - 'isPic'：      是否包含有图片 0-无 1-有
	- 'pic'：        幻灯图片内容
```

> **返回结果示例：**

``` json
{
    "status": 0,
    "data":{
        "newsId": "122",
        "title": "学校建设迈入新阶段",
        "content": "6L+Z5piv5LiA5p2h5paw6Ze75YaF5a65",
        "columnName": "校园风采",   #发布栏目名(对应栏目title)
	    "newsType":"2",
	    "newsReader":[
		    {
			    "tid":"234",
			    "teacherName":"张三"
		    },
		    {
			    "tid":"234",
			    "teacherName":"张三"
		    }
		],                                       #tid
	    "newsClasser":[
		    {
			    "cid":"234",
			    "className":"一班"
		    },
		    {
			    "cid":"234",
			    "className":"高二二班"
		    }
		],                                       #cid
        "isTop": "1",          #是不是置顶0-非置顶；1-置顶
        "isPic": "1",          #是不是包括图片0-不包括；1-包括
        "pic":"url",            #图片地址
        "isAudit":"1",         #0-未审核，1-审核通过，2-审核驳回
        "isHomenews":"1",      #是否为首页轮播0-否，1-是
        "author": "212",        ＃作者id（tid）
        "authorName": "张俪",   ＃作者名（对应teacherName）
        "publishTime": "2016-8-9 00:00:00"   #发布时间
    }
}
```

####2.1.3 新闻新增接口
> 新闻新增接口提供了对新闻的新增功能（注意：不需要审核的新闻发布后是无法修改的，只能删除后重新发布）（注意：显示新闻的时候只要在newsReader及newsClasser范围内的用户都能看到本新闻）
> 有些栏目是不需要审核，添加新闻的时候，所选栏目如果是不需要审核，那么新闻发布出去即为已审核状态，如果需审核，新闻状态为待审核状态

> 需要使用Token验证查询者身份
``` json
Url:        /qxy/news
Method:     POST
Header:     Content-type:application/json
Parameter:
    - 'title'：       新闻标题
    - 'content'：     新闻内容（base64编码）
    - 'columnId'：   发布栏目id
    - 'newsType'：   新闻的阅读范围 0-全部；1-仅教师；2-教师和家长
    - 'newsReader'： 新闻教师阅读范围，为空表示全部
    - 'newsClasser'：新闻班级阅读范围，为空表示全部
    - 'isTop'：      是否置顶0-否，1-是
    - 'publishTime': 发布时间
    - 'isPic'：      是否包含有图片 0-无 1-有
	- 'pic'：         幻灯图片内容
    - 'token'：       token
示例：
{
    "token":"fcc277636dea80d3d298df9465795a875e6eb9df",
    "title":"大新闻",  
    "content":"6L+Z5piv5LiA5p2h5paw6Ze75YaF5a65",
    "columnId":"1",
    "newsType":"2",
    "newsReader":"234;211;332;",       #可阅读的教师tid集合
    "newsClasser":"222;211;233;",      #可阅读的班级cid集合
	"publishTime":"2016-8-9 00:00:00",
    "isPic":"0",
    "pic":"url"
}
Response:
    - `status`：0->is OK
                1->失败，无调用权利
                2->新增失败，无对应的newsId
               11->token is invalid
               12->token is timeout
               13->Illegal interface calls, not power use interface
    - 'newsId'：返回更新成功的新闻newsId
```

> **返回结果示例：**

``` json
{
    "status": 0,
    "data":[
        {
            "newsId":"14"
        }
    ]
}
```

####2.1.4 新闻修改/置顶(取消置顶)/审核(驳回)/加入轮播(取消轮播)接口
> （注意：不需要审核的新闻发布后是无法修改的，只能删除后重新发布）（注意：显示新闻的时候只要在newsReader及newsClasser范围内的用户都能看到本新闻）
> 需要使用Token验证查询者身份
``` json
Url:        /qxy/news
Method:     PUT
Header:     Content-type:application/json
Parameter:
    - 'newsId'：     新闻id
    - 'title'：       新闻标题
    - 'content'：     新闻内容（base64编码）
    - 'columnId'：   发布栏目id
    - 'newsType'：   新闻的阅读范围 0-全部；1-仅教师；2-教师和家长
    - 'newsReader'： 新闻教师阅读范围，为空表示全部
    - 'newsClasser'：新闻班级阅读范围，为空表示全部
    - 'isTop'：      是否置顶0-否，1-是
    - 'publishTime': 发布时间
    - 'isPic'：       是否包含有图片 0-无 1-有
	- 'pic'：         幻灯图片内容
    - 'isAudit':      #0-未审核，1-审核通过，2-审核驳回
    - 'isHomenews'：  #是否为首页轮播0-否，1-是
	- 'isTop'：       #是不是置顶0-非置顶；1-置顶
    - 'token'：       token
示例：
{
    "token":"fcc277636dea80d3d298df9465795a875e6eb9df",
    "newsId":"21",
	"title":"大新闻",  
	"content":"6L+Z5piv5LiA5p2h5paw6Ze75YaF5a65",
	"columnId":"1",
	"newsType":"2",
	"newsReader":"222;211;233;",       #tid
	"newsClasser":"222;211;233;",      #cid
	"publishTime":"2016-8-9 00:00:00",
	"isPic":"0",
	"pic":"url",
	"isAudit":"1",         #0-未审核，1-审核通过，2-审核驳回
	"isHomenews":"1",      #是否为首页轮播0-否，1-是
	"isTop": "1",          #是不是置顶0-非置顶；1-置顶
}
Response:
    - `status`：0->is OK
                1->失败，无调用权利
                2->修改失败，无对应的newsId
                3->置顶(取消置顶)/审核(驳回)/加入轮播(取消轮播)失败，无对应的newsId
               11->token is invalid
               12->token is timeout
               13->Illegal interface calls, not power use interface
```

> **返回结果示例：**

``` json
{
    "status": "0",
	"data":{
		"info":"ok"
	}
}
```

####2.1.5 新闻删除接口
> 需要使用Token验证查询者身份
``` json
Url:        /qxy/news
Method:     DELETE
Header:     Content-type:application/json
Parameter:
    - 'newsId'：      新闻id
    - 'token'：       token
示例：
{
    "token":"fcc277636dea80d3d298df9465795a875e6eb9df",
    "newsIds":[21,22]
}
Response:
    - `status`：0->is OK
                1->删除失败，无调用权利
                2->删除失败，无对应的newsId
               11->token is invalid
               12->token is timeout
               13->Illegal interface calls, not power use interface
```

> **返回结果示例：**

``` json
{
    "status": "0",
	"data":{
		"info":"ok"
	}
}
```
####2.1.6 幻灯图片上传接口
/qxy/news/upload/pictures
>暂缺

### 2.2 新闻栏目管理页面接口
####2.2.1 新闻栏目查询接口
> 新闻栏目查询接口返回了当前的新闻栏目列表，不考虑分页
> 新闻栏目查询接口需要使用Token验证查询者身份
``` json
Url:        /qxy/column?type=[type]&token=[token]
Method:     GET
Header:     Content-type:application/json
Parameter:
    - `type`:    栏目类型0-所有有效的栏目，1-所有栏目，不传默认为有效栏目
    - `token` ：      token
Response:
    - `status`：0->成功
                1->无查询栏目权限
                11->token is invalid
                12->token is timeout
                13->Illegal interface calls, not power use interface
    - 'column':  新闻栏目json
    - 'count':   当前返回新闻栏目条数
```

> **返回结果示例：**

``` json
{
    "status": 0,
    "data": {
        "count":"4",
        "column":[
            {
                "columnId": "2",
                "title": "学校新闻",
                "auth": "1",  #0-全部用户可读,1-仅教工可读,2-家长及教工可读
                "isUse": "1",   ＃是不是启用；0-停用；1-正常
            },
            {
                "columnId": "3",
                "title": "周边新闻",
                "auth": "1",  #0-全部用户可读,1-仅教工可读,2-家长及教工可读
                "isUse": "1",   ＃是不是启用；0-停用；1-正常
            }
        ]
    }
}
```

####2.2.2 新闻栏目新增接口
> 栏目新增接口提供了对栏目的新增功能（注意：显示新闻的时候只要在newsReader及newsClasser范围内的用户都能看到本新闻）

> 需要使用Token验证查询者身份
``` json
Url:        /qxy/column
Method:     POST
Header:     Content-type:application/json
Parameter:
    - 'title'：       栏目名称
    - 'auth'：        #0-全部用户可读；1-仅教工可读；2-家长及教工可读
    - 'isUse'：       #是否启用0-停用，1-启用  新增默认为启用
    - 'token'：       token
示例：
{
    "token":"fcc277636dea80d3d298df9465795a875e6eb9df",
    "title": "学校新闻",
    "auth": "1",
    "isUse": "1"        #是否启用0-停用，1-启用  新增默认为启用
}
Response:
    - `status`：0->is OK
                1->失败，无调用权利
                2->新增失败，重复的栏目名
               11->token is invalid
               12->token is timeout
               13->Illegal interface calls, not power use interface
```

> **返回结果示例：**

``` json
{
    "status": "0",
	"data":{
		"info":"ok"
	}
}
```


####2.2.3 新闻栏目修改及停用(启用)接口
> 栏目修改及停用(启用)接口提供了对栏目的修改及停用(启用)功能（注意：显示新闻的时候只要在newsReader及newsClasser范围内的用户都能看到本新闻）

> 需要使用Token验证查询者身份
``` json
Url:        /qxy/column
Method:     PUT
Header:     Content-type:application/json
Parameter:
    - 'columnId'：   栏目id
    - 'title'：       栏目名称
    - 'auth'：        #0-全部用户可读；1-仅教工可读；2-家长及教工可读
    - 'isUse':       是否启用0-停用，1-启用
    - 'token'：       token
示例：
{
    "token":"fcc277636dea80d3d298df9465795a875e6eb9df",
    "title": "学校新闻",
    "auth": "1",
    "columnId": "1",
    "isUse": "1"
}
Response:
    - `status`：0->is OK
                1->失败，无调用权利
                2->修改失败，重复的栏目名
                3->启用/停用失败，该栏目不存在
               11->token is invalid
               12->token is timeout
               13->Illegal interface calls, not power use interface
```
> **返回结果示例：**
``` json
{
    "status": "0",
	"data":{
		"info":"ok"
	}
}
```
####2.2.4 新闻栏目删除接口
> 栏目修改及停用(启用)接口提供了对栏目的修改及停用(启用)功能（注意：显示新闻的时候只要在newsReader及newsClasser范围内的用户都能看到本新闻）
>该接口支持单条数据删除，不需要批量删除
> 需要使用Token验证查询者身份
``` json
Url:        /qxy/column
Method:     DELETE
Header:     Content-type:application/json
Parameter:
    - 'columnId'：   栏目id
    - 'token'：       token
示例：
{
    "token":"fcc277636dea80d3d298df9465795a875e6eb9df",
    "columnId": "1"
}
Response:
    - `status`：0->is OK
                1->失败，无调用权利
                2->修改失败，重复的栏目名
                3->启用/停用失败，该栏目不存在
               11->token is invalid
               12->token is timeout
               13->Illegal interface calls, not power use interface
```
> **返回结果示例：**
``` json
{
    "status": "0",
	"data":{
		"info":"ok"
	}
}
```


