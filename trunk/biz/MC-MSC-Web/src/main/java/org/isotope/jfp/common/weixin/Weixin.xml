<?xml version='1.0' encoding='UTF-8' ?> 
<!DOCTYPE mapper
    PUBLIC '-//mybatis.org//DTD Dao 3.0//EN' 
    'http://mybatis.org/dtd/mybatis-3-mapper.dtd' >
<!-- 角色功能权限 --> 
<!-- 需要和DAO保持完全路径一致 -->
<mapper namespace='org.isotope.jfp.common.weixin.WeixinDao'>

    <!-- 用户登陆  -->
    <select id='loadCompany' parameterType='java.util.Map' resultType='WeiXinCompany'>
        SELECT * FROM school_weixin
        WHERE is_use = 1 
        	<if test=" companyId != null and companyId !='' "><!-- 学校id -->
            	AND sid = #{companyId}
	        </if>
	        <if test=" appId != null and appId !='' "><!-- 应用ID -->
	            AND app_id = #{appId}
	        </if>
    </select>
    
    <select id='loadCompanyGroup' parameterType='java.util.Map' resultType='WeiXinCompanyGroup'>
        SELECT * FROM school_weixin_group
        WHERE is_use = 1 
        	<if test=" companyId != null and companyId !='' "><!-- 学校id -->
            	AND sid = #{companyId}
	        </if>
	        <if test=" groupId != null and groupId !='' "><!-- 用户组ID -->
	            AND gid = #{groupId}
	        </if>
	        <if test=" wxId != null and wxId !='' "><!-- 微信ID -->
	            AND wx_id = #{wxId}
	        </if>
	        <if test=" wxIdIsNull != null and wxIdIsNull !='' "><!-- 微信ID -->
	            AND (wx_id is null OR wx_id='')
	        </if>
    </select>
    
    <select id='loadCompanyUser' parameterType='java.util.Map' resultType='WeixinCompanyUser'>
        SELECT * FROM school_weixin_user
        WHERE is_use = 1 
        	<if test=" companyId != null and companyId !='' "><!-- 学校id -->
            	AND sid = #{companyId}
	        </if>
	        <if test=" appId != null and appId !='' "><!-- 用户ID -->
	            AND uid = #{userId}
	        </if>
	        <if test=" wxId != null and wxId !='' "><!-- 微信ID -->
	            AND wx_id = #{wxId}
	        </if>
	        <if test=" wxIdIsNull != null and wxIdIsNull !='' "><!-- 微信ID -->
	            AND (wx_id is null OR wx_id='')
	        </if>
    </select>

    <!-- 更新企业微信ID -->
    <update id='updateCompanyById' parameterType='WeiXinCompany'>
        UPDATE school_weixin SET wx_id = #{wxId} WHERE sid = #{sid}
    </update>

	<!-- 更新企业用户组微信ID -->
    <update id='updateCompanyGroupById' parameterType='WeiXinCompanyGroup'>
        UPDATE school_weixin_group SET wx_id = #{wxId} WHERE sid = #{sid}
    </update>
    
    <!-- 更新企业用户微信ID -->
    <update id='updateCompanyUserById' parameterType='WeiXinCompanyUser'>
        UPDATE school_weixin_user SET wx_id = #{wxId} WHERE sid = #{sid}
    </update>
</mapper>
