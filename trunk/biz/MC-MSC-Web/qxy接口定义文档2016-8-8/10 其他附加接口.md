[toc]

## 10 其他附加接口

>标签：接口\手机端接口

---
###  文档更新说明
> 更新时间：2016-08-17
> 新增excel导入接口


### 10.1 excel导入部分
#### 10.1.1 班级学生导入接口
>按班级导入学生，允许一个班级一次性导入
>不同机构下学号和学生信息可以重复，学生导入需要验证学生是否已经存在用户表，如果已经存在则需检查该机构下是否应存在该学生，如果不存在则新增学生信息并关联已经存在的uid，如果已经存在，则直接覆盖该学生信息即可，导入成功后需返回成功导入数量
>excel需要上传地址（确认这样处理是否合理）
>需要token验证
``` json
Url:        /qxy/import/student?token=[token]
Method:     POST
Header:     Content-type:application/json
Parameter:
    - 'cid':      指定班级的id
    - 'excel':    学生数据excel
    - 'token':    token
示例：
{
	"cid":"12",
	"excel":"url"        
}
Response:
    - `status`：0->成功
                1->导入失败，无效班级
                2->导入失败，学生已存在
                11->token is invalid
                12->token is timeout
                13->Illegal interface calls, not power use interface
    - `count`： 导入成功数量
```

> **返回结果示例：**

``` json
{
    "status": "0",
    "data": {
        "info":"ok",
        "count":"15"
    }
}
```

#### 10.1.2 班级学生家长导入接口
>按照班级导入学生家长，允许一个班级一次性导入
>需要根据学生学号和机构sid获取学生id，关联到需要导入的家长数据中，家长手机号及邮箱为系统内唯一，如果已经存在则直接创建关联该家长和学生id，如果学生不存在则无法创建该家长；
>excel需要上传地址（确认这样处理是否合理）
>需要token验证
``` json
Url:        /qxy/import/student/parent?token=[token]
Method:     POST
Header:     Content-type:application/json
Parameter:
    - 'cid':      指定班级的id
    - 'excel':    学生家长数据excel
    - 'token':    token
示例：
{
	"cid":"12",
	"excel":"url"        
}
Response:
    - `status`：0->成功
                1->导入失败，无效班级
                2->导入失败，学生不存在
                11->token is invalid
                12->token is timeout
                13->Illegal interface calls, not power use interface
    - `count`： 导入成功数量
```

> **返回结果示例：**

``` json
{
    "status": "0",
    "data": {
        "info":"ok",
        "count":"15"
    }
}
```

#### 10.1.3 教师导入接口
>可以一次性全部导入
>导入时需要验证教师是否已经存在，如果已经存在则直接覆盖教师信息；
>excel需要上传地址（确认这样处理是否合理）
>需要token验证
``` json
Url:        /qxy/import/teacher?token=[token]
Method:     POST
Header:     Content-type:application/json
Parameter:
    - 'sid':      可选参数，如果传则使用该sid，如果不传则直接使用token中的sid
    - 'excel':    教师数据excel
    - 'token':    token
示例：
{
	"sid":"12",            
	"excel":"url"        
}
Response:
    - `status`：0->成功
                1->导入失败，sid不存在
                11->token is invalid
                12->token is timeout
                13->Illegal interface calls, not power use interface
    - `count`： 导入成功数量
```

> **返回结果示例：**

``` json
{
    "status": "0",
    "data": {
        "info":"ok",
        "count":"15"
    }
}
```


#### 10.1.4 学生卡导入接口
>可以一次性全部导入
>需要根据学号和机构sid获取学生id，关联需要导入的学生卡，一个学生的学生卡有效的只能有一个，需检查有效数量；
>excel需要上传地址（确认这样处理是否合理）
>需要token验证
``` json
Url:        /qxy/import/studentRfid?token=[token]
Method:     POST
Header:     Content-type:application/json
Parameter:
    - 'sid':      可选参数，如果传则使用该sid，如果不传则直接使用token中的sid
    - 'excel':    教师数据excel
    - 'token':    token
示例：
{
	"sid":"12",            
	"excel":"url"        
}
Response:
    - `status`：0->成功
                1->导入失败，sid不存在
                11->token is invalid
                12->token is timeout
                13->Illegal interface calls, not power use interface
    - `count`： 导入成功数量
```

> **返回结果示例：**

``` json
{
    "status": "0",
    "data": {
        "info":"ok",
        "count":"15"
    }
}
```


#### 10.1.5 班级课程表导入接口
>按照班级导入，一次导入一个班级的一个周的课程表
>导入之前需要选择学期年级班级和所要导入的学期的周日期，前端需要传入这个课表应用到的七天日期，例如要应用到2016-8-22、2016-8-23、2016-8-24、2016-8-25、2016-8-26、2016-8-27、2016-8-28，对应到excel模板中的周一、周二、周三、周四、周五、周六、周日；然后导入一个班级的课程表信息，课程表导入仅包含课程信息，课程教师需要到班级管理中配置；
>excel需要上传地址（确认这样处理是否合理）
>需要token验证
``` json
Url:        /qxy/import/syllabus?token=[token]
Method:     POST
Header:     Content-type:application/json
Parameter:
    - 'cid':      班级id必填
    - 'dates':     课程应用日期 如2016-8-17，应为7天
    - 'excel':    教师数据excel
    - 'token':    token
示例：
{
	"cid":"12",  
	"dates":["2016-8-22","2016-8-23","2016-8-24","2016-8-25","2016-8-26","2016-8-27","2016-8-28"],           
	"excel":"url"        
}
Response:
    - `status`：0->成功
                1->导入失败，cid不存在
                11->token is invalid
                12->token is timeout
                13->Illegal interface calls, not power use interface
```

> **返回结果示例：**

``` json
{
    "status": "0",
    "data": {
        "info":"ok"
    }
}
```

### 10.2 消息群发
#### 10.2.1 发送消息接口
>可以选择教工、家长发送短信或者微信消息，前端需要传教师id和家长id，后台需要根据tid和parentId查询到相应的电话号码，发送出相应的信息，并存储至短信消息记录表中，需要存储对象类型，教师id、教师姓名或者家长id及家长姓名，手机号，消息类型，短信内容，发送时间，是否需要回执，状态至新增数据表s_message中；
>需要token验证
``` json
Url:        /qxy/sendMessage?token=[token]
Method:     POST
Header:     Content-type:application/json
Parameter:
    - 'tid':           教师id
    - 'parentId':      家长id
    - 'type':          消息类型：0-短信，1-app推送，2-微信消息
    - 'message'：      短信内容，内容限制75字以内
    - 'isReceipt':     是否需要回执0-否，1-是
示例：
{
	"tid":"12;13;14;",  
	"parentId":"2;3;4;5",           
	"message":"【千校云】（***学校）通知：您的孩子数学基础较弱，请您多抽出时间帮助孩子复习功课，在家多做练习并及时检查，争取成绩有所提高，谢谢您的配合！-宋丽老师",
	"type":"0",
	"isReceipt":"0"
}
Response:
    - `status`：0->发送成功
                11->token is invalid
                12->token is timeout
                13->Illegal interface calls, not power use interface
```

> **返回结果示例：**

``` json
{
    "status": "0",
    "data": {
        "info":"ok"
    }
}
```


#### 10.2.2 短信消息记录查询接口
>可以查询群发消息历史记录，包括消息内容，对象以及发送时间等信息
>需要token验证
``` json
Url:        /qxy/message?page=[page]&size=[size]&token=[token]
Method:     GET
Header:     Content-type:application/json
Parameter:
    - 'page':       班级id必填
    - 'size':       课程应用日期 如2016-8-17，应为7天
    - 'page':       分页编号，分页为0或者空时，返回第一页数据
    - 'size':       每页数据条数，为0或空时，默认返回12条数据
    - 'token':      token
示例：
{
	"page":"2",  
	"size":"12"      
}
Response:
    - `status`：0->ok
                11->token is invalid
                12->token is timeout
                13->Illegal interface calls, not power use interface
    - `count`：  短信消息记录总数
    - 'id':            短消息记录表自增id
    - 'type':          消息类型：0-短信，1-app推送，2-微信消息
    - 'teacherName':   教师姓名
    - 'tid':           教师id
    - 'parentName':    家长姓名
    - 'parentId':      家长id
    - 'object':        对象类型:0-教工；1-家长
    - 'phone':         手机号
    - 'sendingTime':   发送时间
    - 'message'：      短信内容，内容限制75字以内
    - 'isReceipt':     是否需要回执0-否，1-是
    - 'status':        状态0-发送成功；1-发送失败；3-无回执
```

> **返回结果示例：**

``` json
{
    "status": "0",
    "data": {
        "page":"2",
        "size":"12",
        "count":"50",
        "message":[
	        {
		        "id":"1",
		        "type":"0",
		        "teacherName":"张三",
		        "tid":"10",
		        "parentName":"",
		        "parentId":"",
		        "object":"0",
		        "phone":"15235232532",
		        "sendingTime":"2016-8-22 12:12",
		        "message":"【千校云】（***学校）通知：******，谢谢您的配合！-宋丽老师",
		        "isReceipt":"0",
		        "status":"0"
	        },
	        {
				"id":"2",
		        "type":"1",
		        "teacherName":"",
		        "tid":"",
		        "parentName":"赵天佑",
		        "parentId":"12",
		        "object":"1",
		        "phone":"15235235656",
		        "sendingTime":"2016-8-22 12:15",
		        "message":"【千校云】（***学校）通知：******，谢谢您的配合！-宋丽老师",
		        "isReceipt":"0",
		        "status":"0"
	        }
        ]
    }
}
```

#### 10.2.3 教工标签查询接口
>详见
>7 校通讯录管理
>7.1 教工管理页面接口
>7.1.1 教工标签查询接口
#### 10.2.4 教工列表查询接口
>详见
>7 校通讯录管理
>7.1 教工管理页面接口
>7.1.2 教工列表查询接口
#### 10.2.5 学校班级查询接口
>详见
>9 系统设置功能接口说明
>9.3 班级设定页面接口
>9.3.2-1学校班级查询接口

### 10.3 微信企业号千校云平台接入
>详见说明文档