[toc]

## 8 校园安全管理页面接口说明

@(千校云)

> 标签： 接口 校园安全

---

### 文档更新说明
> 更新时间：2016-08-03

### 页面说明
> 校园安全管理功能包括安全日志及安全规则设置两个页面，命名为：安全日志，报警规则。（安全日志的选择由于班级学生的关系应该和学期关联）

> 安全日志页面列出了不同学期的全校班级对应的安全日志数据，并能实现分页显示和实现搜索功能。（本页面缺少一个学期选择框，当前应该是最近的默认启用学期）（安全日志的选择由于班级学生的关系应该和学期关联！）

> 报警规则页面列出了班级对应启用的报警规则，还可以新增报警规则条目（弹窗形式）

### 8.1 安全日志页面接口
#### 8.1.1 学校学期年级班级查询接口（通用）
>9 系统设置
>9.3 班级设定页面接口
>9.3.1学校学期年级班级查询接口（通用）

#### 8.1.2 学生列表查询接口
> 学生列表查询接口返回当时的班级中的学生数据，主要是用来实现选择了班级以后选择学生的下拉框列表
> 需要使用Token验证查询者身份
> 本班级对应的学生简单情况；
``` json
Url:        /qxy/stundent/namelist?cid=[cid]&token=[token]
Method:     GET
Header:     Content-type:application/json
Parameter:
    - `cid`:       查询的班级cid
    - 'token':    token
Response:
    - `status`： 0->OK 
                11->token is invalid
                12->token is timeout
                13->Illegal interface calls, not power use interface
    - `student`: 班级任课内容JSON
    - `count`:   班级课程总数
```

> **返回结果示例：**

``` json
{
    "status": "0",
    "data":{
        "count":"20",
        "termName":"2016-2017-2",
        "gradeName":"高三",
        "className":"一班",
        "student":[
			{   
				"studentId": "3434",
				"studentName": "张高丽"
			},
			{
				"studentId": "3434",
				"studentName": "张高丽"
			},
			{
				"studentId": "3434",
				"studentName": "张高丽"
			}
		]
    }
}
```
#### 8.1.3 安全日志查询接口
> 班级安全日志查询接口返回对应的班级的安全日志列表情况，接口支持分页，支持条件查询（按地点，按时间，按进出标志搜索）
> 学期id，可不传则获取所有列表
> 班级安全日志查询接口需要使用Token验证查询者身份

``` json
Url:        /qxy/securitylog?termId=[termId]&studentId=[studentId]&deviceId=[deviceId]&startTime=[startTime]&endTime=[endTime]&page=[page]&size=[size]&token=[token]
Method:     GET
Header:     Content-type:application/json
Parameter:
    - `termId`:      学期id，可不传则获取所有列表
    - `time`:        查询起始时间，需要和log_security表中markTime对比
    - 'startTime':   指定查询的开始时间割   如不传，默认获取所有或者截止到结束时间的数据
    - 'endTime':     指定查询的结束时间割   如不传，默认获取所有或者从开始时间发布的所有数据
    - `studentId`:     查询学生的id
    - `device`:      查询设备的id
    - `page` ：      page对应的分页编号数字，当page＝0或者page为空时，返回所有的教工list
    - `size` ：      size对应的每页数据条数，当size＝0或者size为空时，默认一页返回12条
    - 'token':    token
Response:
    - `status`： 0->token is OK 
                1->标签地点数据不正确
                10->token is invalid
                12->token is timeout
                13->Illegal interface calls, not power use nterface
    - `securitylog`:  班级安全日志内容JSON
    - `count`:        安全日志条总数
    - `number`:       学号
```

> **返回结果示例：**

``` json
{
    "status": "0",
    "data":{
        "page":"2",
        "size":"12",
        "count":"22",
        "securitylog": [
            {
                "studentId":"222",
                "studentName":"张山",
                "number":"0120515235",
		        "gradeName":"高三",
		        "className":"一班",
		        "deviceName":"校大门口12",
                "flag":"0",   #0-进来；1-出去；2-出现
                "markTime":"2016-8-9 00:00:00"
            },
            {

                "studentId":"223",
                "studentName":"张山",
                "number":"0152325624",
		        "gradeName":"高三",
		        "className":"一班",
		        "deviceName":"校大门口2",
                "flag":"0"   #0-进来；1-出去；2-出现
                "markTime":"2016-8-9 00:00:00"
            }
        ]
    }
}
```

### 8.2 报警规则管理
#### 8.2.1 学校学期年级班级查询接口（通用）
>9 系统设置
>9.3 班级设定页面接口
>9.3.1学校学期年级班级查询接口（通用）

#### 8.2.2-1 班级报警列表查询接口
> 班级报警规则列表查询接口返回对应的班级的安全规则列表情况，学期id，可不传则获取所有列表
> 需要使用Token验证查询者身份

``` json
Url:        /qxy/class/alarmlist?termId=[termId]&page=[page]&size=[size]&token=[token]
Method:     GET
Header:     Content-type:application/json
Parameter:
    - `termId`:        学期id，可不传则获取所有列表
    - `token`:         token
    - `page` ：      page对应的分页编号数字，当page＝0或者page为空时，返回所有的数据list
    - `size` ：      size对应的每页数据条数，当size＝0或者size为空时，默认一页返回12条
    - 'token':    token
Response:
    - `status`：   0->token is OK 
                   1->CID对应的数据不正确
	               10->token is invalid
	               12->token is timeout
	               13->Illegal interface calls, not power use nterface
    - `classlist`:         班级列表内容JSON
    - `count`:             班级总数
```

> **返回结果示例：**

``` json
{
    "status": "0",
    "data":{
        "page":"2",
        "size":"12",
        "count":"22",
        "classlist": [
            {
		        "cid":"11", 
		        "termName":"2016-2017-2",  
		        "gradeName":"高三",
		        "className":"一班", 
		        "classalarmcount":"3",                  #班级报警规则数量
			},		
			{
		        "cid":"12", 
		        "termName":"2016-2017-2",  
		        "gradeName":"高三",
		        "className":"一班", 
		        "classalarmcount":"4",                  #班级报警规则数量
			}
        ]
    }
}
```
#### 8.2.2-2 班级报警列表查询接口
> 班级报警规则列表查询接口返回对应的班级的安全规则列表情况，默认返回当前学期的全部班级报警列表

> 需要使用Token验证查询者身份

``` json
Url:        /qxy/class/alarmlist/search?cid=[cid]&token=[token]
Method:     GET
Header:     Content-type:application/json
Parameter:
    - `cid`:         查询的班级cid  当输入班级id时可不传分页参数
    - `token` ：      token
Response:
    - `status`：   0->token is OK 
                   1->CID对应的数据不正确
	               10->token is invalid
	               12->token is timeout
	               13->Illegal interface calls, not power use nterface
    - `classlist`:         班级列表内容JSON
    - `count`:             班级总数
	- `classalarmcount`:   #班级报警规则数量
```

> **返回结果示例：**

``` json
{
    "status": "0",
    "data":{
		"cid":"11", 
		"termName":"2016-2017-2",  
		"gradeName":"高三",
		"className":"一班", 
		"classalarmcount":"3",                  
	}
}
```

#### 8.2.3 班级报警规则查询接口
> 班级报警规则查询接口返回对应的班级的报警规则情况

> 需要使用Token验证查询者身份

``` json
Url:        /qxy/class/alarmrule?cid=[cid]&token=[token]
Method:     GET
Header:     Content-type:application/json
Parameter:
    - `cid`:         查询的班级id
    - `token` ：      token
Response:
    - `status`：   0->token is OK 
                  1->CID对应的数据不正确
	              10->token is invalid
	              12->token is timeout
	              13->Illegal interface calls, not power use nterface
    - `classalarmrule`:    班级报警规则内容JSON
    - `count`:             班级总数
```

> **返回结果示例：**

``` json
{
    "status": 0,
    "data":{
        "className":"一三班",
        "count":"2",
        "classalarmrule": [
            {
		        "alarmruleId":"222",
                "alarmruleName":"上学校门出入规则",
                "alarmruleinfo":{
	                "deviceName":"校大门口",
	                "startTime":"07:00",
	                "endTime":"08:00",
	                "flag":"0",   #0-进来；1-出去；2-出现
	                "timeType":"0",   #时间设置类型：0-指定重复时间（周一到周日），1-特定的日期；
	                "timeRepeat":"1111100",   #当timeType=0时有效，1111100表示从周一到周五重复
	                "timeDate":"2016-8-9 00:00:00"   #当timeType=1时有效，表示生效的特定日期 
                }
            },		
			{
		        "alarmruleId":"222",
                "alarmruleName":"上学校门出入规则",
                "alarmruleinfo":{
	                "deviceName":"校大门口",
	                "startTime":"07:00",
	                "endTime":"08:00",
	                "flag":"0",   #0-进来；1-出去；2-出现
	                "timeType":"0",   #时间设置类型：0-指定重复时间（周一到周日），1-特定的日期；
	                "timeRepeat":"1111100",   #当timeType=0时有效，1111100表示从周一到周五重复
	                "timeDate":"2016-8-9 00:00:00"   #当timeType=1时有效，表示生效的特定日期 
                }
            }
        ]
    }
}
```

#### 8.2.4 班级报警规则新增接口
> 班级报警规则新增接口新增对应的班级的特定安全规则

> 需要使用Token验证查询者身份

``` json
Url:        /qxy/class/alarmrule
Method:     POST
Header:     Content-type:application/json
Parameter:
    - 'cid':          查询的班级cid
    - 'alarmrule':    报警规则json
    - 'token'：       token
    - 'alarmruleName':         报警规则名称
    - 'deviceId':       #设备id
    - 'startTime'：      #规则执行开始时间，如07:00
    - 'endTime':         #规则执行截止时间，如08:00
    - 'flag':            #0-进来；1-出去；2-出现
    - 'timeType'：       #时间设置类型：0-指定重复时间（周一到周日），1-特定的日期；
    - 'timeRepeat':     #当timeType=0时有效，1111100表示从周一到周五重复
    - 'timeDate'：      #当timeType=1时有效，表示生效的特定日期
    - `token` ：      token
	
示例：
{
    "token":"fcc277636dea80d3d298df9465795a875e6eb9df",
    "cid": "123",
    "alarmrule":{
	    "alarmruleName":"早自习按时到校规则",
	    "deviceId":"11",           
        "startTime":"07:00",      
        "endTime":"08:00",        
        "flag":"0",       
        "timeType":"0",  
        "timeRepeat":"1111100",   
        "timeDate":"2016-8-9 00:00:00"   
	}
｝
Response:
    - `status`： 0->token is OK 
                1->CID对应的数据不正确
                10->token is invalid
                12->token is timeout
                13->Illegal interface calls, not power use nterface
```

> **返回结果示例：**

``` json
{
    "status": "0",
	"data":{
		"info":"ok"
	}
}
```
#### 8.2.5 班级报警规则修改接口
> 班级报警规则修改接口新增对应的班级的特定安全规则

> 需要使用Token验证查询者身份

``` json
Url:        /qxy/class/alarmrule
Method:     PUT
Header:     Content-type:application/json
Parameter:
    - 'token'：       token
    - 'alarmruleId'：       
    - 'alarmruleName':         报警规则名称
    - 'deviceId':          #设备id
    - 'startTime'：      #规则执行开始时间，如07:00
    - 'endTime':         #规则执行截止时间，如08:00
    - 'flag':            #0-进来；1-出去；2-出现
    - 'timeType'：       #时间设置类型：0-指定重复时间（周一到周日），1-特定的日期；
    - 'timeRepeat':     #当timeType=0时有效，1111100表示从周一到周五重复
    - 'timeDate'：      #当timeType=1时有效，表示生效的特定日期
    - `token` ：      token
示例：
{
    "token":"fcc277636dea80d3d298df9465795a875e6eb9df",
    "alarmruleId":"12",
    "alarmruleName":"早自习按时到校规则",
    "deviceId":"11",           
    "startTime":"07:00",      
    "endTime":"08:00",        
    "flag":"0",        
    "timeType":"0",   
    "timeRepeat":"1111100",  
    "timeDate":"2016-8-9 00:00:00"   
｝
Response:
    - `status`： 0->token is OK 
                1->CID对应的数据不正确
                10->token is invalid
                12->token is timeout
                13->Illegal interface calls, not power use nterface
```

> **返回结果示例：**

``` json
{
    "status": "0",
	"data":{
		"info":"ok"
	}
}
```
#### 8.2.6 班级报警规则删除接口
> 班级报警规则修改接口新增对应的班级的特定安全规则

> 需要使用Token验证查询者身份

``` json
Url:        /qxy/class/alarmrule
Method:     DELETE
Header:     Content-type:application/json
Parameter:
    - 'cid':             查询的班级cid
    - 'alarmruleId':     报警规则id
    - 'token'：          token
示例：
{
    "token":"fcc277636dea80d3d298df9465795a875e6eb9df",
    "cid": "123",
    "alarmruleIds":"12"
｝
Response:
    - `status`： 0->token is OK 
                1->CID对应的数据不正确
                10->token is invalid
                12->token is timeout
                13->Illegal interface calls, not power use nterface
```

> **返回结果示例：**

``` json
{
    "status": "0",
	"data":{
		"info":"ok"
	}
}
```

#### 8.2.7 班级报警规则应用至其他班接口
> 班级报警规则修改接口新增对应的班级的特定安全规则

> 需要使用Token验证查询者身份

``` json
Url:        /qxy/class/alarmrule/copy
Method:     PUT
Header:     Content-type:application/json
Parameter:
    - 'cids':             要应用到的班级集合
    - 'alarmruleIds':    要应用的规则id集合 
    - 'token'：           token
示例：
{
    "token":"fcc277636dea80d3d298df9465795a875e6eb9df",
    "cids":[1,2,3,4,5,6],                          #要应用到的班级集合
    "alarmruleIds":[12,13,14,15,16]                #要应用的规则id集合 
｝
Response:
    - `status`： 0->token is OK 
                1->CID对应的数据不正确
                10->token is invalid
                12->token is timeout
                13->Illegal interface calls, not power use nterface
```

> **返回结果示例：**

``` json
{
    "status": "0",
	"data":{
		"info":"ok"
	}
}
```
### 8.3 报警规则管理
#### 8.3.1 学校学期年级班级查询接口（通用）
>9 系统设置
>9.3 班级设定页面接口
>9.3.1学校学期年级班级查询接口（通用）

#### 8.3.2-1 学生rfid卡列表查询接口
> 查询学生rfid关联列表，一个学生可以有多张rfid卡，但是只有一张卡是当前有效的；
> 需要使用Token验证查询者身份
``` json
Url:        /qxy/studentrfidlist?termId=[termId]&cid=[cid]&page=[page]&size=[size]&token=[token]
Method:     GET
Header:     Content-type:application/json
Parameter:
    - `termId`: 学期id，可不传则获取所有列表
    - `cid`: 班级id，可不传则获取所有列表
    - `page`:   分页编号，分页为0或者空时，返回全部数据
    - `size`:   每页数据条数，为0或空时，默认返回12条数据
    - `token`: token
Response:
    - `status`：0->token is OK 
                11->token is invalid
                12->token is timeout
                13->Illegal interface calls, not power use interface
    - `studentrfid`: 学生内容JSON
    - `count`:       学生总数
```

> **返回结果示例：**

``` json
{
    "status": 0,
    "data":{
        "page":"1",
        "size":"12",
        "count":"200",
        "studentrfid":[
              {   
                  "studentId": "3434",
                  "studentName": "张高丽",          #学生名字  
				  "number":"01252523",    
                  "rfidlist":[
	                  {
		                  "rfid"："012545236",       #rfid卡号
		                  "isEffective":"1"         #0-否；1-是；
	                  },
	                  {
		                  "rfid"："012545237",
		                  "isEffective":"0"         #0-否；1-是；
	                  }
                  ] 
              },
              {   
                  "studentId": "3434",
                  "studentName": "张高丽",          #学生名字  
	              "number":"01252523",  
                  "rfidlist":[
	                  {
		                  "rfid"："012545236",
		                  "isEffective":"1"         #0-否；1-是；
	                  },
	                  {
		                  "rfid"："012545237",
		                  "isEffective":"0"         #0-否；1-是；
	                  }
                  ] 
              }
          ]
        
    }
}
```
#### 8.3.2-2 学生rfid卡列表搜索接口
> 查询学生rfid关联列表，一个学生可以有多张rfid卡，但是只有一张卡是当前有效的；
> 需要使用Token验证查询者身份
``` json
Url:        /qxy/studentrfidlist/search?studentId=[studetId]&token=[token]
Method:     GET
Header:     Content-type:application/json
Parameter:
    - `studentId`:   学生id
    - `token`:       token
Response:
    - `status`：0->token is OK 
                11->token is invalid
                12->token is timeout
                13->Illegal interface calls, not power use interface
    - `studentrfid`: 学生内容JSON
    - `count`:       学生总数
```

> **返回结果示例：**

``` json
{
    "status": 0,
    "data":{   
	  "studentId": "3434",
	  "studentName": "张高丽",          #学生名字
	  "number":"01252523",  
	  "rfidlist":[
		  {
			  "rfid"："012545236",       #rfid卡号
			  "isEffective":"1"         #0-否；1-是；
		  },
		  {
			  "rfid"："012545237",
			  "isEffective":"0"         #0-否；1-是；
		  }
	  ] 
    }
}
```
#### 8.3.3 学生rfid卡新增接口
> 新增学生rfid卡，一个学生可以有多张rfid卡，但是只有一张卡是当前有效的，默认新增第一张为有效的卡；
> 需要使用Token验证查询者身份
``` json
Url:        /qxy/studentrfid
Method:     POST
Header:     Content-type:application/json
Parameter:
    - `rfid`:        rfid卡号
    - `studentId`:  学生id
    - `token`:       token
示例：
{
	"rfid":"012525236",
	"studentId":"12",
	"token":"skskksksiek129439493ksiodf09w23"
}

Response:
    - `status`：0->OK
                1->新增失败，学生不存在 
                11->token is invalid
                12->token is timeout
                13->Illegal interface calls, not power use interface
    - `studentrfid`: 学生内容JSON
    - `count`:       学生总数
```

> **返回结果示例：**

``` json
{
    "status": "0",
	"data":{
		"info":"ok"
	}
}
```

#### 8.3.4 学生rfid卡修改及设为有效（默认为无效）接口
> 修改学生rfid卡，一个学生可以有多张rfid卡，但是只有一张卡是当前有效的，默认新增第一张为有效的卡；
> 设定某个rfid卡有效接口必须确保一个学生的所有关联rfid卡中只有一个是无效的，所以在确认设为有效之前可以先把该学生其他的卡设为无效；
> 需要使用Token验证查询者身份
``` json
Url:        /qxy/studentrfid
Method:     PUT
Header:     Content-type:application/json
Parameter:
    - `rfid`:              rfid卡号
    - `studentId`:        学生id
    - `id`:               学生rfid卡关联表自增id
    - `isEffective`:      是否有效：0-否；1-是；
    - `token`:             token
示例：
{
	"id":"1",
	"rfid":"012525236",
	"studentId":"12",
	"isEffective":"1",
	"token":"skskksksiek129439493ksiodf09w23"
}

Response:
    - `status`：0->OK 
                11->token is invalid
                12->token is timeout
                13->Illegal interface calls, not power use interface
    - `studentrfid`: 学生内容JSON
    - `count`:       学生总数
```

> **返回结果示例：**

``` json
{
    "status": "0",
	"data":{
		"info":"ok"
	}
}
```
#### 8.3.5 学生rfid卡删除接口
> 需要使用Token验证查询者身份
> 判断rfid卡是否为有效，如果有效就不能删除，需要设为无效后再删除
``` json
Url:        /qxy/studentrfid
Method:     DELETE
Header:     Content-type:application/json
Parameter:
    - `id`:   学生rfid卡关联表自增id
    - `token`:             token
示例：
{
	"id":"1",
	"token":"skskksksiek129439493ksiodf09w23"
}

Response:
    - `status`：0->OK 
				1->删除失败，rfid卡为有效卡，请设为无效后再删除
                11->token is invalid
                12->token is timeout
                13->Illegal interface calls, not power use interface
    - `studentrfid`: 学生内容JSON
    - `count`:       学生总数
```

> **返回结果示例：**

``` json
{
    "status": "0",
	"data":{
		"info":"ok"
	}
}
```

#### 8.3.6-1 rfid卡对应学生列表查询接口

> 查询rfid对应学生关联列表，一个学生可以有多张rfid卡，但是只有一张卡是当前有效的；
> 需要使用Token验证查询者身份
``` json
Url:        /qxy/rfidstudent?page=[page]&size=[size]&token=[token]
Method:     GET
Header:     Content-type:application/json
Parameter:
    - `page`:   分页编号，分页为0或者空时，返回全部数据
    - `size`:   每页数据条数，为0或空时，默认返回12条数据
    - `token`:   token
Response:
    - `status`：0->token is OK 
                11->token is invalid
                12->token is timeout
                13->Illegal interface calls, not power use interface
    - `rfidstudent`:   rfid卡对应学生内容JSON
    - `count`:         rfid卡总数
```

> **返回结果示例：**

``` json
{
    "status": 0,
    "data":{
        "page":"1",
        "size":"12",
        "count":"200",
        "rfidstudent":[
              {   
                  "rfid"："012545236",         #rfid卡号
		          "isEffective":"1",          #0-否；1-是；
                  "studentId": "3434",
                  "studentName": "张高丽",          #学生名字
	              "number":"01252523",    
                  "createTime": "2016-8-9 00:00:00",          #邮箱   
              },
              {   
                  
                  "rfid"："012545236",         #rfid卡号
		          "isEffective":"1",          #0-否；1-是；
                  "studentId": "3434",
                  "studentName": "张高丽",          #学生名字
	              "number":"01252523",    
                  "createTime": "2016-8-9 00:00:00",          #邮箱   
              }
         ]
    }
}
```
#### 8.3.6-2 rfid卡对应学生搜索接口

> 查询rfid对应学生关联列表，一个学生可以有多张rfid卡，但是只有一张卡是当前有效的；
> 需要使用Token验证查询者身份
``` json
Url:        /qxy/rfidstudent/search?rfid=[rfid]&token=[token]
Method:     GET
Header:     Content-type:application/json
Parameter:
    - `rfid`:   rfid
    - `token`:   token
Response:
    - `status`：0->token is OK 
                11->token is invalid
                12->token is timeout
                13->Illegal interface calls, not power use interface
    - `rfidstudent`:   rfid卡对应学生内容JSON
    - `count`:         rfid卡总数
```

> **返回结果示例：**

``` json
{
    "status": 0,
    "data":{   
		  "rfid"："012545236",         #rfid卡号
		  "isEffective":"1",          #0-否；1-是；
		  "studentId": "3434",
		  "studentName": "张高丽",          #学生名字
	      "number":"01252523",     
		  "createTime": "2016-8-9 00:00:00",          #邮箱   
	  }
}
```







