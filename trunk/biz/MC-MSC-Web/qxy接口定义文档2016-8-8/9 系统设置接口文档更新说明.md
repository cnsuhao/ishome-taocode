[TOC]

## 千校云接口文档更新说明
> 2016-7-22：统一约定时间戳为标准时间格式；
> 2016-8-1：更新文档，参照restfull规范定义接口
> 2016-8-5:更新简化班级列表查询结果结构，去掉批量删除接口


## 9、系统设置功能接口说明

@(交接)

> 标签： 接口 系统设置

---

### 文档更新说明
> 更新时间：2016-07-28

### 页面说明
 > 系统设置功能包括以下页面：密码修改页面、课程开设管理、班级设定、学校作息时间管理页面、年级标签管理、设备管理、权限管理，命名为：修改密码、课程管理、班级管理、课表作息时间、年级标签、设备管理、权限管理。

 > 密码修改页面为用户修改密码的页面，输入区域包括：原始密码和新密码。

 > 课程开设管理页面为本学校开设的课程列表和维护页面（可以修改课程名称，新增课程，删除课程和停用课程，停用的课程可以重新启用），课程列表相对较短（中小学不会有太多课程）故不考虑分页（接口依然提供分页功能）。

 > 班级开设设定页面为本学期开设的班级列表页面和新增班级管理页面以及修改班级标签的页面（可以删除，修改和新增班级，班级的显示采用标签完成），班级页面实现分页显示并可以通过接口获取更多的班级关联信息。

 > 学校作息时间管理页面为学校作息时间及对应班级采用的作息时间列表页面以及对应的班级关联作息时间模版的设置页面和学习作息时间模版列表选择页面，为了能管理学习作息时间模版，还有对应的作息时间模版新增，和作息时间模版详情列表页面，以及作息时间模版的新增设定页面。作息时间模版及每个模版对应的模版都不会太多内容，故不考虑分页处理。

> 年级标签管理设定该学校年级标签（系统管理员可以新增、删除、修改年级标签）。

> 设备管理设定该校rfid设备及设备报警查询（系统管理员可以新增、删除、修改rfid设备）。

> 权限管理设定学校管理员、普通教师访问后台页面权限，需补充页面及需求文档。


### 9.1 密码管理页面接口
#### 9.1.1 密码修改提交接口
> 密码管理修改提交接口提交了特定用户（教师）的密码，生效后原有密码失效

> 需要使用Token验证查询者身份
> 2016-8-9liuchqing:

``` json
Url:        /qxy/uppassword?token=[token]
Method:     PUT
Header:     Content-type:application/json
Parameter:
    - 'oldpassword':           提交的旧密码，如""，加密方法待定
    - 'newpassword':           提交的新密码，如""，加密方法待定
    - 'token'：                token
示例：
{
    "oldpassword":"3223222",
    "newpassword":"7888232"
}
Response:
    - `status`：0->ok
                1->无权限修改密码
                2->修改密码失败，旧密码不正确
                3->修改密码失败，新密码与旧密码一致
                4->修改密码失败，新密码强度不够
                11->token is invalid
                12->token is timeout
                13->Illegal interface calls, not power use interface
```

> **返回结果示例：**


``` json
{
    "status": "0",
	"data":{
		"info":"ok"
	}
}
```

### 9.2 课程管理页面接口
#### 9.2.1学校课程查询接口
> 学校课程查询接口返回了学校当前设置的课程列表，不需要分页。为简单操作起见，课程设置时不关联学期，如果需要关联学期，则需要配置课程时需要按学期配置

> 需要使用Token验证查询者身份

``` json
Url:        /qxy/course?type=[type]&token=[token]
Method:     GET
Header:     Content-type:application/json
Parameter:
	- 'type'：   type＝0，或者为空，仅仅返回有效数据，type＝1，返回全部数据
    - `token` ：      token
Response:
    - `status`：0->OK 
                11->token is invalid
                12->token is timeout
                13->Illegal interface calls, not power use interface
    - `courselist`: 学校课程内容JSON
    - `count` : 学校课程总数
    - `isUse` : #0-停用；1-正常，当type＝1时才返回
```

> **返回结果示例：**

``` json
{
    "status": 0,
    "data": {
        "count":"3",
        "courselist": [
            {
                "courseId": "2",
                "courseName": "数学",
                "isUse": "1"   #0-停用，1-正常，当type＝1时才返回
            },
            {
                "courseId": "1",
                "courseName": "语文",
                "isUse": "0"   
            },
            {
                "courseId": "3",
                "courseName": "化学"
                "isUse": "0"   
            }
        ]
    }
}
```
#### 9.2.2学校课程新增接口
> 需要使用Token验证查询者身份
``` json
Url:        /qxy/course?token=[token]
Method:     POST
Header:     Content-type:application/json
Parameter:
    - 'courseName'：   课程名字
    - 'token'：         token
示例：
{
	"courseName":"数学"
}
Response:
    - `status`：0->OK
                1->新增失败，无权使用
                2->新增失败，名字重复
               11->token is invalid
               12->token is timeout
               13->Illegal interface calls, not power use interface
```

> **返回结果示例：**

``` json
{
    "status": "0",
	"data":{
		"info":"ok"
	}
}
```

#### 9.2.3学校课程修改包括停用(启用)接口
> 需要使用Token验证查询者身份

``` json
Url:        /qxy/course?token=[token]
Method:     PUT
Header:     Content-type:application/json
Parameter:
    - 'courseId'：     需要修改的课程id
    - 'isUse':         0-启用；1-停用
    - 'courseName'：   需要修改的名称名称，仅在变更名字时有效
    - 'token'：         token
示例：
{
	"courseId":"4",
    "courseName":"代数",
    "isUse":"0"  
}
Response:
    - `status`：0->OK
                1->变更名称，名称不能为空
                2->无法删除，已经使用的课程无法删除
                3->已经停用的无法再次停用
                4->未停用的无法启用
               11->token is invalid
               12->token is timeout
               13->Illegal interface calls, not power use interface
```

> **返回结果示例：**

``` json
{
    "status": "0",
	"data":{
		"info":"ok"
	}
}
```

#### 9.2.4学校课程删除接口
> 需要使用Token验证查询者身份

``` json
Url:        /qxy/course?token=[token]
Method:     DELETE
Header:     Content-type:application/json
Parameter:
    - 'courseId'：   需要删除的课程id
    - 'token'：       token
示例：
{
	"courseId":"4"
}
Response:
    - `status`：0->OK
                1->删除失败，无权使用
                2->删除失败，无此编号
               11->token is invalid
               12->token is timeout
               13->Illegal interface calls, not power use interface
```

> **返回结果示例：**

``` json
{
    "status": "0",
	"data":{
		"info":"ok"
	}
}
```

### 9.3 班级设定页面接口
#### 9.3.1学校学期年级班级查询接口（通用）
> 该接口用户查询学期年级班级完整数据，作为系统通用接口
> 需要使用Token验证查询者身份

``` json
Url:        /qxy/termgradeclass?type=[type]&token=[token]
Method:     GET
Header:     Content-type:application/json
Parameter:
        - 'type':    是否返回所有学期数据  0-有效学期数据，1-返回所有学期数据，不传或为空时返回有效学期下的数据，包含年级和班级
Response:
        - `status`:           0->OK 
                              10->token is invalid
                              12->token is timeout
                              13->Illegal interface calls, not power use interface
        - `term`:              学期内容JSON
        - `grade`:             年级内容JSON
        - `class`:             班级内容JSON
        - `count`:             学期总数
        - `isDefault`:        #0-可查看学期；1-缺省设置学期
        - `isUse`:            #是否启用0-停用；1-正常
```

> **返回结果示例：**

``` json
{
    "status": 0,
    "data":{
        "count":"2",
        "term": [
            {
                "termId":"1",
                "termName": "2016-2017-1",
                "isDefault":"1",          #0-可查看学期；1-缺省学期
                "isUse":"1",              #0-停用；1-正常
                "grade":[
					{
						"gradeId":"1",
						"gradeName"："高一"，
						"isUse":"1",              #0-停用；1-正常	
						"class":[
							{
								"cid":"1",
								"className":"一班"
							}，
							{
								"cid":"2",
								"className":"二班"
							}
						]
					}，
					{
						"gradeId":"1",
						"gradeName"："高一"，
						"isUse":"1",              #0-停用；1-正常	
						"class":[
							{
								"cid":"1",
								"className":"一班"
							}，
							{
								"cid":"2",
								"className":"二班"
							}
						]
					}
				]
            },
            {
                "termId":"1",
                "termName": "2016-2017-1",
                "isDefault":"0",  
                "isUse":"1",
                "grade":[
					{
						"gradeId":"1",
						"gradeName"："高一"，
						"isUse":"1",              #0-停用；1-正常		
						"class":[
							{
								"cid":"1",
								"className":"一班"
							}，
							{
								"cid":"2",
								"className":"二班"
							}
						]
					}
				]
            }
        ]
    }
}
```


#### 9.3.2-1学校班级查询接口
> 学校班级查询接口返回了学校当前指定的学期上设置的班级列表，带分页请求，当page＝null或为0时，返回第一页的班级数据。

> 需要使用Token验证查询者身份

``` json
Url:        /qxy/class?termId=[termId]&page=[page]&size=[size]&token=[token]
Method:     GET
Header:     Content-type:application/json
Parameter:
    - `termId`:        学期id，可不传则获取所有列表
    - `page`：         page对应的分页编号数字，当page＝0或者page为空时，默认返回第一页
    - `size`：         size对应的每页数据条数，当size＝0或者size为空时，默认一页返回12条
    - 'token'：        token
Response:
    - `status`：0->OK 
               11->token is invalid
               12->token is timeout
               13->Illegal interface calls, not power use interface
    - `date`：学期年级班级内容JSON
    - `count`：总数
    - 'isLeader':是否为班主任，0-不是；1-是；
```

> **返回结果示例：**

``` json
{
    "status": 0,
    "data":{
	    "page":"0",                 #为0时，返回全部班级
	    "size":"12",                #为0时，默认每页返回12条数据
        "count":"2",
        "class":[
	        {
                "cid":"234",
                "className":"一班",
                "termName":"2016-2017-1", 
                "gradeName":"高三",
                "createTime":"2016-8-9 00:00:00",
                "tid": "3434",
                "teacherName": "张高丽",
            },
            {
                "cid":"234",
                "className":"一班",
                "termName":"2016-2017-1", 
                "gradeName":"高三",
                "createTime":"2016-8-9 00:00:00",
                "tid": "34341",
                "teacherName": "张高1丽",
             }   
     ]
}
```
#### 9.3.2-2学校班级搜索接口

> 需要使用Token验证查询者身份

``` json
Url:        /qxy/class/search?cid=[cid]&token=[token]
Method:     GET
Header:     Content-type:application/json
Parameter:
    - 'cid'：           查询的班级cid
    - `token`：         token
Response:
    - `status`：0->OK 
               11->token is invalid
               12->token is timeout
               13->Illegal interface calls, not power use interface
    - `date`：学期年级班级内容JSON
    - `count`：总数
    - 'isLeader':是否为班主任，0-不是；1-是；
```

> **返回结果示例：**

``` json
{
    "status": 0,
    "data":{
		"cid":"234",
		"className":"一班",
		"termName":"2016-2017-1", 
		"gradeName":"高三",
		"createTime":"2016-8-9 00:00:00",
		"tid": "3434",
		"teacherName": "张高丽",
    }
}
```

#### 9.3.3学校班级新增接口
> 学校班级新增接口可以新增学校班级，班级名称不能重复，班级名称属于系统分配生成，如选择2016年入学，高一年级，共创建2个班，那么班级名称为1班和2班，班级名称可以修改；

> 需要使用Token验证查询者身份

``` json
Url:        /qxy/class?token=[token]
Method:     POST
Header:     Content-type:application/json
Parameter:
    - 'termId'：     当前学期ID
    - 'year'：        入学时间
    - 'count'：       班级数量
    - 'gradeId'：    年级标签id
    - 'token'：       token
示例：
{
	"termId":"12",
    "year":"2016",
    "count": "3",
    "gradeId": "22"
}
Response:
    - `status`：0->is OK
                1->建立班级失败，无权使用
                2->建立班级失败，班级重复
                3->建立班级的学期已完结，无新增学期
               11->token is invalid
               12->token is timeout
               13->Illegal interface calls, not power use interface
```

> **返回结果示例：**

``` json
{
    "status": "0",
	"data":{
		"info":"ok"
	}
}
```

#### 9.3.4学校班级修改接口
> 需要使用Token验证查询者身份

``` json
Url:        /qxy/class?token=[token]
Method:     PUT
Header:     Content-type:application/json
Parameter:
    - 'cid'：         需要修改的班级ID
    - 'gradeId'：      年级id
    - 'className'：   班级名字
    - 'year'：        入学年份
    - 'token'：       token
示例：
{
    "cid":"1234",
    "gradeId":"12",   
    "className": "三班",   
    "year": "2016"
}
Response:
    - `status`：0->OK
                1->修改标签失败，标签为空，标签无效
                2->修改班级失败，班级已经使用无法删除
               11->token is invalid
               12->token is timeout
               13->Illegal interface calls, not power use interface
```

> **返回结果示例：**

``` json
{
    "status": "0",
	"data":{
		"info":"ok"
	}
}
```

#### 9.3.5学校班级删除接口
> 需要使用Token验证查询者身份
``` json
Url:        /qxy/class?token=[token]
Method:     DELETE
Header:     Content-type:application/json
Parameter:
    - 'cid'：         需要修改的班级ID
    - 'token'：       token
示例：
{
    "cid":"1234",
}
Response:
    - `status`：0->OK
                1->删除失败，无权限
                2->删除失败，班级不存在
               11->token is invalid
               12->token is timeout
               13->Illegal interface calls, not power use interface
```

> **返回结果示例：**

``` json
{
    "status": "0",
	"data":{
		"info":"ok"
	}
}
```



####9.3.6学校班级班主任指定接口
> 班级班主任更新接口为更新特定班级的班主任老师数据。需要特别注意老师指定为班主任的之前，需要先把该班级中老师的isLeader字段置为0，然后再把该教师的isLeader字段设为1，目的保证该班级只能有一个班主任；

> 需要使用Token验证查询者身份

``` json
Url:        /qxy/class/leader?token=[token]
Method:     PUT
Header:     Content-type:application/json
Parameter:
    - `cid`：         特定的班级数据，cid为空返回所有数据
    - 'tid':          教师id
    - 'isLeader':     1-设为班主任
    - 'token'：       token
示例：
{
    "cid":"234",
    "tid": "2334",
    "isLeader": "1" 
}
Response:
    - `status`： 0->OK 
                1->指定班主任失败，无权限
                2->指定班主任失败，班级不存在
                10->token is invalid
                12->token is timeout
                13->Illegal interface calls, not power use interface
```

> **返回结果示例：**

``` json
{
    "status": "0",
	"data":{
		"info":"ok"
	}
}
```

### 9.4. 学校作息模版设置页面接口
#### 9.4.1-1 班级作息模版查询接口
> 班级作息模版查询接口返回了学校当前指定的每个班级使用的作息时间模版情况
 
>  需要使用Token验证查询者身份

``` json
Url:        /qxy/class/worktime?termId=[termId]&page=[page]&size=[size]&token=[token]
Method:     GET
Header:     Content-type:application/json
Parameter:
    - `termId`:        学期id，可不传则获取所有列表
    - `page`：         page对应的分页编号数字，当page＝0或者page为空时，返回第一页数据
    - `size`：         size对应的每页数据条数，当size＝0或者size为空时，默认一页返回12条
    - 'token'：        token
Response:
    - `status`：0->OK 
               11->token is invalid
               12->token is timeout
               13->Illegal interface calls, not power use interface
    - `date`：学校班级作息模板内容JSON
    - `count`：总数
    - `workId`：作息时间模板id
    - `workName`：作息时间模板内容
 
```

> **返回结果示例：**

``` json
{
    "status": 0,
    "data":{
	    "page":"0",                 #为0时，返回第一页数据
	    "size":"12",                #为0时，默认每页返回12条数据
        "count":"2",
        "class":[
			{
				"cid":"234",
				"className":"一班",
				"termName":"2016-2017-1", 
				"gradeName":"高三",
				"workId":"15",
				"workName":"作息时间模板名称",
				"createTime":"2016-8-9 00:00:00"
			},
			{
                "cid":"234",
                "className":"一班",
                "termName":"2016-2017-1", 
                "gradeName":"高三",
                "workId":"15",
                "workName":"作息时间模板名称",
                "createTime":"2016-8-9 00:00:00"
            }   
		]
	}
}
```
#### 9.4.1-2 班级作息模版搜索接口
 
>  需要使用Token验证查询者身份

``` json
Url:        /qxy/class/worktime/search?cid=[cid]&token=[token]
Method:     GET
Header:     Content-type:application/json
Parameter:
    - 'cid'：          查询的班级cid
    - 'token'：        token
Response:
    - `status`：0->OK 
               11->token is invalid
               12->token is timeout
               13->Illegal interface calls, not power use interface
    - `date`：学校班级作息模板内容JSON
    - `count`：总数
    - `workId`：作息时间模板id
    - `workName`：作息时间模板内容
 
```

> **返回结果示例：**

``` json
{
    "status": 0,
    "data":{
		"cid":"234",
		"className":"一班",
		"termName":"2016-2017-1", 
		"gradeName":"高三",
		"workId":"15",
		"workName":"作息时间模板名称",
		"createTime":"2016-8-9 00:00:00"
	}
}
```
#### 9.4.2 班级作息模版新增接口
> 可以一次性给多个班级指定同一个模板，但是一个班只能对应一个作息时间模板
> 需要使用Token验证查询者身份

``` json
Url:        /qxy/class/worktime?token=[token]
Method:     POST
Header:     Content-type:application/json
Parameter:
    - `cid`：         特定的班级数据，cid为空返回所有数据
    - 'workId':      作息时间模板id
    - 'token'：       token
示例：
{
    "workId":"3",
    "cid":[12,13,14,15]
}
Response:
    - `status`：0->is OK
                1->新增失败，无权使用
                2->新增失败，班级不存在
               11->token is invalid
               12->token is timeout
               13->Illegal interface calls, not power use interface
```

> **返回结果示例：**

``` json
{
    "status": "0",
	"data":{
		"info":"ok"
	}
}
```


#### 9.4.3 班级作息模版修改接口
> 需要使用Token验证查询者身份
> 一次只能对一个班级的作息模板进行修改

``` json
Url:        /qxy/class/worktime?token=[token]
Method:     PUT
Header:     Content-type:application/json
Parameter:
    - `cid`：         特定的班级数据，cid为空返回所有数据
    - 'workId':       作息时间模板id
    - 'token'：       token
示例：
{
    "cid":"16",
    "workId":"3"
}
Response:
    - `status`：0->is OK
                1->修改失败，无权使用
                2->修改失败，班级不存在
               11->token is invalid
               12->token is timeout
               13->Illegal interface calls, not power use interface
```

> **返回结果示例：**

``` json
{
    "status": "0",
	"data":{
		"info":"ok"
	}
}
```


#### 9.4.4 班级作息模版删除接口
> 需要使用Token验证查询者身份
> 班级的作息时间模板会将class表中关联的workId变为0即可；
``` json
Url:        /qxy/class/worktime?token=[token]
Method:     DELETE
Header:     Content-type:application/json
Parameter:
    - `cid`：         特定的班级id
    - 'token'：       token
示例：
{
    "cid":"12" 
}
Response:
    - `status`：0->is OK
                1->删除失败，无权使用
                2->删除失败，班级不存在
               11->token is invalid
               12->token is timeout
               13->Illegal interface calls, not power use interface
```

> **返回结果示例：**

``` json
{
    "status": "0",
	"data":{
		"info":"ok"
	}
}
```


#### 9.4.5 学校作息模版查询接口
> 需要使用Token验证查询者身份

``` json
Url:        /qxy/worktime?token=[token]
Method:     GET
Header:     Content-type:application/json
Parameter:
    - 无    ：
Response:
    - `status`：0->OK 
               11->token is invalid
               12->token is timeout
               13->Illegal interface calls, not power use interface
    - `schoolwork`：学校作息模版JSON
    - `count`：总数
```

> **返回结果示例：**

``` json
{
    "status": 0,
    "data":{
        "count":"2",
        "schoolwork": [
            {
                "workId":"124",
                "workName":"普通班作息模版",
                "count":"2",
                "createTime":"2016-8-9 00:00:00",
                "workRule": [
	                {
						"wruleId": "1",
						"wruleName": "第一节课",
                        "wruleStage": "早晨",
                        "startTime": "07:00",
                        "endTime": "08:00"
					},
					{
						"wruleId": "2",
						"wruleName": "第二节课",
                        "wruleStage": "早晨",
                        "startTime": "09:00",
                        "endTime": "10:00"
					}
                ]
            },
            {
                "workId":"123",
                "workName":"毕业班作息模版",
                "count":"4",
                "createTime":"2016-8-9 00:00:00",
                "workRule": [
	                {
						"wruleId": "1",
						"wruleName": "第一节课",
                        "wruleStage": "早晨",
                        "startTime": "07:00",
                        "endTime": "08:00"
					},
					{
						"wruleId": "2",
						"wruleName": "第二节课",
                        "wruleStage": "早晨",
                        "startTime": "09:00",
                        "endTime": "10:00"
					}
                ]
            }
          
        ]
    }
}
```

#### 9.4.6 学校作息模版新增接口
> 学校作息模版新增接口可以新增学校作息模版

> 需要使用Token验证查询者身份

``` json
Url:        /qxy/worktime?token=[token]
Method:     POST
Header:     Content-type:application/json
Parameter:
	- 'workName'：   作息时间模版名称
	- 'token'：       token
示例：
{
    "workName":"高中毕业班作息"
}
Response:
    - `status`：0->OK
                1->建立模版失败，无权使用
                2->建立模版失败，名称重复
               11->token is invalid
               12->token is timeout
               13->Illegal interface calls, not power use interface
```

> **返回结果示例：**

``` json
{
    "status": "0",
	"data":{
		"info":"ok"
	}
}
```

#### 9.4.7 学校作息模版修改接口
> 需要使用Token验证查询者身份
``` json
Url:        /qxy/worktime?token=[token]
Method:     PUT
Header:     Content-type:application/json
Parameter:
	- 'workId'：     作息时间模版id
	- 'workName'：   作息时间模版名称
	- 'token'：       token
示例：
{
    "workId":"111"
    "workName":"高中毕业班作息"
}
Response:
    - `status`：0->OK
                1->更新模版失败，无权使用
                2->更新模版失败，名称重复
               11->token is invalid
               12->token is timeout
               13->Illegal interface calls, not power use interface
```

> **返回结果示例：**

``` json
{
    "status": "0",
	"data":{
		"info":"ok"
	}
}
```


#### 9.4.8 学校作息模版删除接口
> 学校作息模版删除接口可以删除学校作息模版，删除之前需要检查是否被应用到班级中，如果有则不能删，如果没有可以删除；

> 需要使用Token验证查询者身份

``` json
Url:        /qxy/worktime?token=[token]
Method:     DELETE
Header:     Content-type:application/json
Parameter:
	- 'workId'：     作息模版id
	- 'token'：       token
示例：
{
    "workId":"123"
}
Response:
    - `status`：0->OK
                1->删除模版失败，无权使用
                2->删除模版失败，无此模版编号
               11->token is invalid
               12->token is timeout
               13->Illegal interface calls, not power use interface
```

> **返回结果示例：**

``` json
{
    "status": "0",
	"data":{
		"info":"ok"
	}
}
```
#### 9.4.9-s 作息模版详情查询接口
> 需要根据模板id查询详情，数量不多，不考虑分页
> 需要使用Token验证查询者身份

``` json
Url:        /qxy/workrule?workId=[workId]&token=[token]
Method:     GET
Header:     Content-type:application/json
Parameter:
    - 'workId'：    作息模板id
Response:
    - `status`：0->OK 
               11->token is invalid
               12->token is timeout
               13->Illegal interface calls, not power use interface
    - `workrule`：学校作息模版JSON
    - `count`：总数
```

> **返回结果示例：**

``` json
{
    "status": 0,
    "data":{
        "count":"2",
        "workId":"1",
        "workName":"作息模板一",
        "workrule": [
			{
				"wruleId": "1",
				"wruleName": "第一节课",
				"wruleStage": "早晨",
				"startTime": "07:00",
				"endTime": "08:00"
			},
			{
				"wruleId": "2",
				"wruleName": "第二节课",
				"wruleStage": "早晨",
				"startTime": "09:00",
				"endTime": "10:00"
			}
        ]
    }
}
```
#### 9.4.9 作息模版详情新增接口
> 作息模版详情新增接口可以新增指定模版的详细条目

> 需要使用Token验证查询者身份

``` json
Url:        /qxy/workrule?token=[token]
Method:     POST
Header:     Content-type:application/json
Parameter:
    - 'workId':        需要新增详情对应的模版编号
    - 'wruleName'：    新增详情的名称
    - 'wruleStage'：   新增详情对应的时间段
    - 'startTime'：    新增详情对应的起点时间
    - 'endTime'：      新增详情对应的结束时间
    - 'token'：         token
示例：
{
	"workId":"1234",
    "wruleName":"早自习一",
    "wruleStage":"0",   ＃0-早晨 1-上午 2-中午 3-下午 4-傍晚 5-夜间
    "startTime":"07:00",
    "endTime":"08:00"
}
Response:
    - `status`：0->OK
                1->新增详情失败，无调用权利
                2->新增详情失败，无对应的workId
               11->token is invalid
               12->token is timeout
               13->Illegal interface calls, not power use interface
```

> **返回结果示例：**

``` json
{
    "status": "0",
	"data":{
		"info":"ok"
	}
}
```
#### 9.4.10 学校作息模版详情修改接口
> 需要使用Token验证查询者身份
``` json
Url:        /qxy/workrule?token=[token]
Method:     PUT
Header:     Content-type:application/json
Parameter:
    - 'wruleId'：      详情的id
    - 'wruleName'：    详情的名称
    - 'wruleStage'：   详情对应的时间段
    - 'startTime'：    详情对应的起点时间
    - 'endTime'：      详情对应的结束时间
    - 'token'：         token
示例：
{
	"wruleId":"1234",
    "wruleName":"早自习一",
    "wruleStage":"0",   ＃0-早晨 1-上午 2-中午 3-下午 4-傍晚 5-夜间
    "startTime":"07:00",
    "endTime":"08:00"
}
Response:
    - `status`：0->OK
                1->更新详情失败，无调用权利
                2->更新新增详情失败，无对应的wruleId
               11->token is invalid
               12->token is timeout
               13->Illegal interface calls, not power use interface
  
```

> **返回结果示例：**

``` json
{
    "status": "0",
	"data":{
		"info":"ok"
	}
}
```

#### 9.4.11 作息模版详情删除接口
> 作息模版详情删除接口可以删除指定模版的详细条目

> 作息模版详情删除接口需要使用Token验证查询者身份

``` json
Url:        /qxy/workrule?token=[token]
Method:     DELETE
Header:     Content-type:application/json
Parameter:
    - 'wruleId'：          删除详情对应的id
    - 'token'：             token
示例：
{
    "wruleId":"1"
}
Response:
    - `status`：0->OK
                1->删除详情失败，无调用权利
                2->删除详情失败，无对应的wruleId
               11->token is invalid
               12->token is timeout
               13->Illegal interface calls, not power use interface
```

> **返回结果示例：**

``` json
{
    "status": "0",
	"data":{
		"info":"ok"
	}
}
```

### 9.5年级标签管理
####9.5.1 班级年级标签查询接口
> 需要使用Token验证查询者身份

``` json
Url:        /qxy/gradelabel?type=[type]&token=[token]
Method:     GET
Header:     Content-type:application/json
Parameter:
    - `type`:   如果不传返回也是有效的年级标签，0-返回有效的年级标签，1-返回所有的年级标签
Response:
    - `status`： 0->OK 
                11->token is invalid
                12->token is timeout
                13->Illegal interface calls, not power use interface    
```

> **返回结果示例：**
``` json
{
    "status": 0,
    "data":{
        "count":"2",
        "grade": [
            {
                "gradeId":"1",
                "gradeName":"高三"
                "isUse":"0"
            },
            {
                "gradeId":"2",
                "gradeName":"高二"
                "isUse":"1"
            }
        ]
    }
}
```
#### 9.5.2 班级年级标签新增接口
> 需要使用Token验证查询者身份
``` json
Url:        /qxy/gradelabel?token=[token]
Method:     POST
Header:     Content-type:application/json
Parameter:
    - 'gradeName':   年级标签名字
    - 'token':     token

示例
{
	"gradeName":"一年级"
}	
Response:
    - `status`： 0->OK 
				1->新增失败，无权限
				2->新增失败，年级标签已存在
                11->token is invalid
                12->token is timeout
                13->Illegal interface calls, not power use interface    
```

> **返回结果示例：**
``` json
{
    "status": "0",
	"data":{
		"info":"ok"
	}
}
```



#### 9.5.3 班级年级标签修改及停用（启用）接口
> 需要使用Token验证查询者身份
``` json
Url:        /qxy/gradelabel?token=[token]
Method:     PUT
Header:     Content-type:application/json
Parameter:
    - 'gradeId':     年级标签id
    - 'gradeName':   年级标签名字
    - 'isUse':       0-停用，1-启用  
    - 'token':        token
示例
{
	"gradeId":"1",
	"gradeName":"一年级",
	"isUse":"0"
}	
	
Response:
    - `status`： 0->OK 
				1->更新失败，无权限
				2->更新失败，年级标签已存在
                11->token is invalid
                12->token is timeout
                13->Illegal interface calls, not power use interface    
```

> **返回结果示例：**
``` json
{
    "status": "0",
	"data":{
		"info":"ok"
	}
}
```
#### 9.5.4 班级年级标签删除接口
> 需要使用Token验证查询者身份

``` json
Url:        /qxy/gradelabel?token=[token]
Method:     DELETE
Header:     Content-type:application/json
Parameter:
    - 'gradeId':     年级标签id
    - 'token':        token
示例：
{
    "gradeId":"1"
}
Response:
    - `status`： 0->OK 
				1->删除失败，无权限
				2->删除失败，该年级标签不存在
                11->token is invalid
                12->token is timeout
                13->Illegal interface calls, not power use interface    
```

> **返回结果示例：**
``` json
{
    "status": "0",
	"data":{
		"info":"ok"
	}
}
```

### 9.6 学校设备管理页面接口

#### 9.6.1-1 设备按学校查询接口
> RFID标签查询接口返回对应的学校RFID标签读卡器设置信息，无分页功能

> 需要使用Token验证查询者身份

``` json
Url:        /qxy/deviceinfo?sid=[sid]&token=[token]
Method:     GET
Header:     Content-type:application/json
Parameter:
    - 'sid':       学校id,不传会返回自己学校的设备
    - 'dgroupId':  设备分组id,必须传
Response:
    - `status`： 0->token is OK 
                10->token is invalid
                12->token is timeout
                13->Illegal interface calls, not power use interface
    - `device`:  安装地点内容JSON
    - `count`:  安装地点总数
    - `deviceId`:设备id
    - `deviceName`:设备名称
    - `dgroupName`:设备分组名称
    - `schoolName`:学校名称
    - `username`:设备账号
    - `password`:设备密码
    - 'id':           设备标签表自增id
```

> **返回结果示例：**

``` json
{
    "status": 0,
    "data":{
        "count":"2",
        "device": [
            {
				"id":"1",
                "deviceId":"1526253653",
                "dgroupId":"1",
                "deviceName":"校门2",
                "schoolName":"武汉一中",
                "username":"mark",
                "password":"125425"
            },
            {
				"id":"2",
                "deviceId":"1526253652",
                "dgroupId":"1",
                "deviceName":"校门1",
                "schoolName":"武汉一中",
                "username":"mark1",
                "password":"1254252"
            }
        ]
    }
}
```

#### 9.6.1-2 设备按分组条件查询接口
> RFID标签查询接口返回对应的学校RFID标签读卡器设置信息，无分页功能

> 需要使用Token验证查询者身份

``` json
Url:        /qxy/deviceinfo/dgroup?dgroupId=[dgroupId]&token=[token]
Method:     GET
Header:     Content-type:application/json
Parameter:
    - 'token':    token
    - dgroupId    设备分组id, --必填项
Response:
    - `status`： 0->token is OK 
                10->token is invalid
                12->token is timeout
                13->Illegal interface calls, not power use interface
    - `device`:  安装地点内容JSON
    - `count`:  安装地点总数
    - `deviceId`:设备id
    - `deviceName`:设备名称
    - `dgroupName`:设备分组名称
    - `schoolName`:学校名称
    - `username`:设备账号
    - `password`:设备密码
    - 'id':           设备标签表自增id
```

> **返回结果示例：**

``` json
{
    "status": 0,
    "data":{
        "count":"2",
        "device": [
            {
				"id":"1",
                "deviceId":"1526253653",
                "dgroupId":"1",
                "deviceName":"校门2",
                "schoolName":"武汉一中",
                "username":"mark",
                "password":"125425"
            },
            {
				"id":"2",
                "deviceId":"1526253652",
                "dgroupId":"1",
                "deviceName":"校门1",
                "schoolName":"武汉一中",
                "username":"mark1",
                "password":"1254252"
            }
        ]
    }
}
```
#### 9.6.2 设备新增接口
> 需要使用Token验证查询者身份

``` json
Url:        /qxy/deviceinfo?token=[token]
Method:     POST
Header:     Content-type:application/json
Parameter:
    - 'deviceId':     设备id
    - 'dgroupId':     设备分组id
    - 'sid':          学校id
    - 'deviceName':   设备名字
    - 'username':     设备账号
    - 'password':     设备密码
    - 'token':        token
实例：
{
    "deviceId":"12234dddd2",
    "sid":"1",
    "dgroupId":"1",
    "deviceName":"学校校dd门",
    "username":"test1",
    "password":"123456"
}	
Response:
    - `status`： 0->OK 
				1->新增失败，无权限
				2->新增失败，该设备已存在
                11->token is invalid
                12->token is timeout
                13->Illegal interface calls, not power use interface    
```

> **返回结果示例：**
``` json
{
    "status": "0",
	"data":{
		"info":"ok"
	}
}
```

#### 9.6.3 设备修改接口
> 需要使用Token验证查询者身份

``` json
Url:        /qxy/deviceinfo?token=[token]
Method:     PUT
Header:     Content-type:application/json
Parameter:
    - 'id':           设备标签表自增id
    - 'deviceId':     设备id
    - 'sid':          学校id
    - 'deviceName':   设备名字
    - 'dgroupId':     设备分组id   
    - 'username':     设备账号
    - 'password':     设备密码
    - 'token':        token

实例：
{
    "id":"1",
    "deviceId":"12234dddd2",
    "sid":"1",
    "dgroupId":"1",
    "deviceName":"学校校dd门",
    "username":"test1",
    "password":"123456"
}	
Response:
    - `status`： 0->OK 
				1->更新失败，无权限
				2->更新失败，该设备已存在
                11->token is invalid
                12->token is timeout
                13->Illegal interface calls, not power use interface    
```

> **返回结果示例：**
``` json
{
    "status": "0",
	"data":{
		"info":"ok"
	}
}
```

#### 9.6.4 设备删除接口
> 需要使用Token验证查询者身份
``` json
Url:        /qxy/deviceinfo?token=[token]
Method:     DELETE
Header:     Content-type:application/json
Parameter:
    - 'id':           设备标签表自增id
    - 'token':        token
示例：
{
    "id":"12"
}
Response:
    - `status`： 0->OK 
				1->删除失败，无权限
				2->删除失败，该设备已被删除
                11->token is invalid
                12->token is timeout
                13->Illegal interface calls, not power use interface    
```

> **返回结果示例：**
``` json
{
    "status": "0",
	"data":{
		"info":"ok"
	}
}
```

#### 9.6.5 设备报警查询接口
> 需要使用Token验证查询者身份
``` json
Url:        /qxy/devicealarm?deviceId=[deviceId]page=[page]&size=[size]&token=[token]
Method:     GET
Header:     Content-type:application/json
Parameter:
    - `deviceId`：       设备id
    - `page`：         page对应的分页编号数字，当page＝0或者page为空时，返回第一页数据
    - `size`：         size对应的每页数据条数，当size＝0或者size为空时，默认一页返回12条
    - `token`：        token
Response:
    - `status`： 0->token is OK 
                10->token is invalid
                12->token is timeout
                13->Illegal interface calls, not power use interface
    - `device`:  安装地点内容JSON
    - `count`:  安装地点总数
    - `deviceId`:设备id
    - `deviceName`:设备名称
    - `schoolName`:学校名称
    - `username`:设备账号
    - `password`:设备密码
    - `sendTime`:心跳包触发时间
    - `alarmInformation`:报警信息
    - `alarmTime`:告警时间
    - `count`:总数
    - `page`:分页
```

> **返回结果示例：**

``` json
{
    "status": 0,
    "data":{
        "deviceId":"1526253653",
        "deviceName":"校门2",
        "schoolName":"学校名称",
        "username":"mark",
        "password":"125425",
	    "page":"0",
        "count":"23",
        "devicealarm": [
            {
                "id":"3",
                "sendTime":"2016-8-9 00:00:00",
                "alarmInformation":"武汉一中",
                "alarmTime":"2016-8-9 00:00:00"
            },
            {

                "id":"3",
                "sendTime":"2016-8-9 00:00:00",
                "alarmInformation":"武汉一中",
                "alarmTime":"2016-8-9 00:00:00"
            }
        ]
    }
}
```

#### 9.6.6 设备说明
####  9.6.6.1 功能说明
- RFID功能设置接口主要实现RFID主机与系统的认证，异常设备报警，以及接收设备发送上来的RFID卡读取纪录三个主要功能
- RFID系统认证接口通过设备访问平台的心跳包接口来实现，设备定时访问平台，发送心跳包，心跳包中包括有设备的用户名和密码（通过数据库DeviceTag分配）。平台接收心跳包，验证用户名和密码信息后返回验证结果，并将心跳包数据纪录到数据库中（device_heartbeat)，主要是纪录接收心跳包的当前时间。
- 设备异常报警接口由操作系统定时触发（URL方式，无参数，操作系统定期触发访问），接口检查心跳包的最后更新时间，对于超过报警设置时间的（报警设置时间通过后台的ini或者接口写入），接口将报警信息写入设备报警表中（device_alarm)
- 设备读卡信息接收接口主要实现了纪录读卡器大规模上传读卡数据的功能，该接口有较大的并发处理要求，考虑采用MQ（直接使用阿里云消息队列）进行数据收取和数据处理分离。即接口直接将信息写入到MQ中（生产者），另外做一个MQ服务程序（消费者）对数据进行处理，日志入库，和生成学生日志纪录功能。

####  9.6.6.2 功能实现
-  RFID系统认证接口采用常规的接口方式，接收到心跳包后，查询DeviceTag表验证用户名和密码，并返回，同时写入心跳包日志表。
-  异常报警核查接口由系统触发，触发后检查心跳包日志表，对于超过时间没有心跳包的设备，写入一条设备报警日志。报警的检查时间可以由接口进行设定（统一的报警检查时间），缺省值由ini文件读取。
-  设备读卡信息接口由两部分组成，一部分是接口接口，该接口接收设备发来的设备读取信息，并将信息和到达时间写入MQ（阿里云MQ）。另外一部分是MQ的消费者，运行后直接读取MQ中的内容（消费者），对于接收到的内容，写入到log_attendance表中。并根据rfid的卡号，查询是否有对应的学生（检查studentRfid表中的内容，因高峰出入学校时查询较频繁，需要考虑做内存缓存本表，如Redis）。对有学生的RFID信息写入到学生的RFID表中（log_security），对没有学生信息的需要再日志表中标记为无效信息

####  9.6.6.3 接口的输入和输出
##### - RFID系统认证接口
> 认证接口接收的心跳包格式如下：
>
> •	定义:sendTimecardData.t?username=xxx&password=xxx&keepalive＝1 

##### - 异常报警核查接口
> 异常报警核查接口有带参数和不带参数两种调用方式，带参数的为设置报警时间，不带为刷新检查报警日志
>
> •	定义:sendTimeoutData.t 或者 sendTimeoutData.t?time=300&password=xxx
>
> password为固定值（写入在缺省时间配置的ini文件中）

##### - 设备读卡信息接口
> 功能描述: 接收远程提交过来的考勤数据
> 
> •	处理方式:接收远程JSON数据
> 
> •	接口定义:sendTimecardData.t?username=xxx&password=xxx&datas={rfid号1,学校编号1,time; rfid号2, 学校编号1,time }
> 
> •	请求参数datas说明：
> 
> datas - String
必选，批量将数据提交到服务器，每个学生基本信息由分号(“;”)分隔，另外每个学生的属性信息由逗号(“,”)分隔，第一个逗号之前的是发送时间、第二个逗号之前的是学校编号，第二个逗号之后的是rfid号码。另外，rfid号、学校编号、发送时间均必须是数字类型的不能带有其他特殊字符。
> 
> 请求举例说明： sendTimecardData.t?datas=1111111111,002720004,999999999;2222222222,002720004,888888888这样一个请求说明有两个学生考勤信息，发送时间分别是1111111111和2222222222，学校编号均为002720004，他们的rfid号码分别是999999999和888888888。
> 
> 注：http请求的具体地址规范为：http://ip:port/sendTimecardData.t?datas=1111111111,002720004,999999999;2222222222,002720004,888888888
> 
> 请以POST UTF-8编码提交到服务   

```
数据返回格式:
  {"code":0,"msg":"成功"} 或 {"code":4,"msg":"编号为：00270004不在有效时间内"} 。其他情况不一一举例
 返回值中code字段说明： 
0：成功;
1：用户名密码错误;
2:考勤数据为空错误;
3：考勤数据为空或数据异常;
4:不在考勤时间段内;
5:考勤数据格式错误，导致系统异常
 返回值中msg字段说明：处理后的提示信息,具体内容参考code字段后的描述器
```
##9.7 学校设备分组管理
#### 9.7.1 设备分组列表查询接口
> sid是学校设备分组的前置条件，无分页功能

> 需要使用Token验证查询者身份

``` json
Url:        /qxy/device/group?sid=[sid]&token=[token]
Method:     GET
Header:     Content-type:application/json
Parameter:
    - 'sid':    学校id,不传会返回登录者所在学校的设备
Response:
    - `status`： 0->token is OK 
                10->token is invalid
                12->token is timeout
                13->Illegal interface calls, not power use interface
    - `dgroup`:  设备分组内容JSON
    - `sid`:  学校id
    - `schoolName`:  学校名称
    - `dgroupId`:设备分组id
    - `dgroupName`:设备分组名称
    - `createTime`:设备分组创建时间
    - `dgroupExplain`:设备分组说明
   
```

> **返回结果示例：**

``` json
{
    "status": 0,
    "data":{
        "sid":"123456789",
        "schoolName":"一中",
        "dgroup": [
            {
				"dgroupId":"1",
                "dgroupName":"大门",
                "dgroupExplain":"放置在正大门口",
                "createTime":"2016-09-26 12:20:30"
            },
            {
				"dgroupId":"2",
                "dgroupName":"寝室",
                "dgroupExplain":""放置在寝室门口",
                "createTime":"2016-09-26 12:20:30"
            },
        ]
    }
}
```

#### 9.7.2 设备分组新增接口

> 需要使用Token验证查询者身份

``` json
Url:        /qxy/device/group?token=[token]
Method:     POST
Header:     Content-type:application/json
Parameter:
   - `dgroup`:                      设备分组内容JSON
    - `sid`:                        学校id
    - `dgroupName`:                 设备分组名称
    - `dgroupExplain`:              设备分组说明
    - `is_use`:                     是否启用，默认是启用的is_use=1
    - 'token':                       token
实例：
{
    "sid":"123456789",
    "dgroupName":"设备分组名称",
    "dgroupExplain":"设备分组说明",
    "is_use":"1"
}	
Response:
    - `status`： 0->OK 
				1->新增失败，无权限
				2->新增失败，该设备分组已存在
                11->token is invalid
                12->token is timeout
                13->Illegal interface calls, not power use interface    
```

> **返回结果示例：**
``` json
{
    "status": "0",
	"data":{
		"info":"ok"
	}
}
```
#### 9.7.3 设备分组修改接口
> 需要使用Token验证查询者身份

``` json
Url:        /qxy/device/group?token=[token]
Method:     PUT
Header:     Content-type:application/json
Parameter:
    - `dgroupId`:  设备分组id
    - `sid`:  学校id
    - `dgroupName`:设备分组名称
    - `dgroupExplain`:设备分组说明
    - 'token':        token

实例：
{
    "dgroupId":"1",
    "sid":"123456789",
    "dgroupName":"设备分组名称",
    "dgroupExplain":"设备分组说明"
}	
Response:
    - `status`： 0->OK 
				1->更新失败，无权限
                11->token is invalid
                12->token is timeout
                13->Illegal interface calls, not power use interface    
```

> **返回结果示例：**
``` json
{
    "status": "0",
	"data":{
		"info":"ok"
	}
}
```

#### 9.7.4 设备分组删除接口
> 需要使用Token验证查询者身份
``` json
Url:        /qxy/device/group?token=[token]
Method:     DELETE
Header:     Content-type:application/json
Parameter:
    - 'dgroupId':           设备分组表自增id
    - 'token':        token
示例：
{
    "dgroupId":"12"
}
Response:
    - `status`： 0->OK 
				1->删除失败，无权限
				2->删除失败，该设备分组已被删除
                11->token is invalid
                12->token is timeout
                13->Illegal interface calls, not power use interface    
```

> **返回结果示例：**
``` json
{
    "status": "0",
	"data":{
		"info":"ok"
	}
}
```

