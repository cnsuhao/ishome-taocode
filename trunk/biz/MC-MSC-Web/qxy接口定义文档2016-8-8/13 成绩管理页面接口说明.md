 [toc]

## 13 成绩管理页面接口说明

@(千校云)

> 标签： 接口 成绩管理

---


### 文档更新说明
> 更新时间：2016-09-22
> 作者：luodibashi

### 页面说明
> 包括成绩标签管理和成绩表管理；

> 成绩标签管理页面设定成绩基础标签；成绩表管理为学生成绩引用成绩标签做的分组统计功能；

>声明开发测试时前端需要在url上加上test=true参数，标示为测试接口，接口会返回静态数据以提供给前端调试页面使用，前端需要使用测试接口完成数据渲染工作后，等到正式接口开发完成后，才能调用正式接口；

### 13.1 成绩标签管理页面接口
####13.1.1 成绩标签列表查询接口
> 
> 需要使用Token验证查询者身份

``` json
Url:        /qxy/results/tag?termId=[termId]&page=[page]&size=[size]&token=[token]
Method:     GET
Header:     Content-type:application/json
Parameter:
    - 'termId': 学期ID，termId为0或者为空时，查询默认学期数据；
    - 'page':   分页编号，分页为0或者空时，返回第一页数据
    - 'size':   每页数据条数，为0或空时，默认返回12条数据
    - 'token'： 用户登录的token
Response:
    - 'status'：0->OK
                1->无效的termId
                11->token is invalid
                12->token is timeout
                13->Illegal interface calls, not power use interface
    - 'termName':        学期名称
    - 'page':            页码
    - 'size':            每页显示条数
    - 'count':           数据总数
    - 'resultsTagList':  成绩标签列表
    - 'resultsTagId'：   成绩标签id
    - 'resultsTagName':  成绩标签名称  
    - 'resultsTagExplain'：成绩标签说明
    - 'startTime'：      考试开始时间
    - 'endTime'：        考试结束时间
    - 'createTime'：     成绩标签创建时间
```

> **返回结果示例：**

``` json
{
    "status": 0,
    "data": {
        "termName":"2016-2017-2", 
        "page":"2",
        "size":"12",
        "count":"20",
        "resultsTagList":[
            {
                "resultsTagId":"1",
                "resultsTagName":"2016年9月校考模拟考试",       
                "resultsTagExplain":"这是一场摸底考试",         
                "startTime":"2016-8-9 00:00:00",      
                "endTime":"2016-8-10 00:00:00",    
                "createTime":"2016-8-10 00:00:00"
            },
            {
                "resultsId":"2",
                "resultsTagName":"2016年9月校考模拟考试1",       
                "resultsTagExplain":"这是一场摸底考试2",         
                "startTime":"2016-9-9 00:00:00",      
                "endTime":"2016-9-10 00:00:00", 
                "createTime":"2016-9-10 00:00:00"
            }
        ]
    }
}
```
####13.1.2 成绩标签新增接口
> 需要使用Token验证查询者身份
> 成绩标签默认有学校属性，新增时接口需要根据token中sid进行关联；
``` json
Url:        /qxy/results/tag?token=[token]
Method:     POST
Header:     Content-type:application/json
Parameter:
    - 'termId'：               学期id--必填项
    - 'resultsTagName' ：      成绩标签名称--必填项
    - 'resultsTagExplain' ：   成绩标签说明
    - 'startTime' ：           考试开始时间
    - 'endTime' ：             考试结束时间
    - 'token'：                token

示例：
{
	"termId":"12",
	"resultsTagName":"成绩标签名称",
	"resultsTagExplain":"成绩标签说明",
	"startTime":"2016-8-9 00:00:00",
	"endTime":"2016-8-10 00:00:00"
}

Response:
    - 'status'：0->OK
                1->新增失败，该学期Id不存在
               11->token is invalid
               12->token is timeout
               13->Illegal interface calls, not power use interface
```

> **返回结果示例：**

``` json
{
    "status": 0,
    "data":{
        "info": "ok"
    }
}
```

####13.1.3 成绩标签修改接口
> 需要使用Token验证查询者身份
``` json
Url:        /qxy/results/tag?token=[token]
Method:     PUT
Header:     Content-type:application/json
Parameter:
    - 'resultsTagId'：         成绩标签id--必填项
    - 'termId'：               学期id
    - 'resultsTagName'：       成绩标签名称
    - 'resultsTagExplain'：    成绩标签说明
    - 'startTime'：            考试开始时间
    - 'endTime'：              考试结束时间
    - 'token'：                token
示例：
{
    "resultsTagId":"1",  
    "termId":"12",
    "resultsTagName":"第一次摸底考试",
    "resultsTagExplain":"这是第一次摸底考试",
	"startTime":"2016-8-9 00:00:00",
	"endTime":"2016-8-10 00:00:00"
}
Response:
    - 'status'：0->OK
                1->修改失败，学期不存在
               11->token is invalid
               12->token is timeout
               13->Illegal interface calls, not power use interface
```

> **返回结果示例：**

``` json
{
    "status": 0,
    "data":{
	    "info":"ok"
    }
}
```

####13.1.4 成绩标签删除接口
> 需要使用Token验证查询者身份
``` json
Url:        /qxy/results/tag?token=[token]
Method:     DELETE
Header:     Content-type:application/json
Parameter:
    - 'resultsTagId'：         成绩标签id--必填项
    - 'token'：                token
示例：
{
    "resultsTagId":"1"
}
Response:
    - 'status'：0->OK
                1->该成绩标签下已经有学生成绩，不能删除
                2->该成绩标签不存在
               11->token is invalid
               12->token is timeout
               13->Illegal interface calls, not power use interface
```

> **返回结果示例：**

``` json
{
    "status": 0,
    "data":{
	    "info":"ok"
    }
}
```

####13.1.5 成绩标签名字搜索接口
> 需要使用Token验证查询者身份
> 默认根据token中的sid条件查询
``` json
Url:        /qxy/results/tag/search?termId=[termId]&resultsTagName=[resultsTagName]&token=[token]
Method:     GET
Header:     Content-type:application/json
Parameter:
    - 'termId'：                 学期Id--必填项
    - 'resultsTagName'：         成绩标签名称--必填项
    - 'token'：                  token
Response:
    - 'status'：0->OK
                1->该学期不存在
                2->成绩标签名字不存在
               11->token is invalid
               12->token is timeout
               13->Illegal interface calls, not power use interface
    - 'termName':        学期名称
    - 'count':           数据总数
    - 'resultsTagList':  成绩标签列表
    - 'resultsTagId'：   成绩标签id
    - 'resultsTagName':  成绩标签名称  
    - 'resultsTagExplain'：成绩标签说明
    - 'startTime'：      考试开始时间
    - 'endTime'：        考试结束时间
    - 'createTime'：     成绩标签创建时间
```

> **返回结果示例：**

``` json
{
    "status": 0,
    "data":{
	    "termName":"2016-2017-2",
	    "count":"2",
	    "resultsTagList":[
            {
                "resultsTagId":"1",
                "resultsTagName":"2016年9月校考模拟考试",       
                "resultsTagExplain":"这是一场摸底考试",         
                "startTime":"2016-8-9 00:00:00",      
                "endTime":"2016-8-10 00:00:00",    
                "createTime":"2016-8-10 00:00:00"
            },
            {
                "resultsId":"2",
                "resultsTagName":"2016年9月校考模拟考试1",       
                "resultsTagExplain":"这是一场摸底考试2",         
                "startTime":"2016-9-9 00:00:00",      
                "endTime":"2016-9-10 00:00:00", 
                "createTime":"2016-9-10 00:00:00"
            }
        ]
    }
}
```
####13.1.6 成绩标签详情查询接口
> 需要使用Token验证查询者身份
``` json
Url:        /qxy/results/tag/info?resultsTagId=[resultsTagId]&token=[token]
Method:     GET
Header:     Content-type:application/json
Parameter:
    - 'resultsTagId'：         成绩标签id--必填项
    - 'token'：                token
Response:
    - 'status'：0->OK
                1->该成绩标签不存在
               11->token is invalid
               12->token is timeout
               13->Illegal interface calls, not power use interface
    - 'resultsTagId'：   成绩标签id
    - 'resultsTagName':  成绩标签名称  
    - 'resultsTagExplain'：成绩标签说明
    - 'startTime'：      考试开始时间
    - 'endTime'：        考试结束时间
    - 'createTime'：     成绩标签创建时间
```

> **返回结果示例：**

``` json
{
    "status": 0,
    "data":{
		"resultsTagId":"1",
		"resultsTagName":"2016年9月校考模拟考试",       
		"resultsTagExplain":"这是一场摸底考试",         
		"startTime":"2016-8-9 00:00:00",      
		"endTime":"2016-8-10 00:00:00",    
		"createTime":"2016-8-10 00:00:00"
    }
}
```

####13.1.7 学期列表查询接口
> 引用6.2.1

### 13.2 成绩表管理页面接口
####13.2.1 班级列表查询接口
> 引用4.1.2-1
####13.2.2 班级列表搜索接口
> 引用4.1.2-2

####13.2.3 班级学生成绩列表查询接口
> 需要使用Token验证查询者身份

``` json
Url:        /qxy/results?resultsTagId=[resultsTagId]&cid=[cid]&page=[page]&size=[size]&token=[token]
Method:     GET
Header:     Content-type:application/json
Parameter:
    - 'resultsTagId'：         成绩标签id--必填项
    - 'cid'：                  班级id--必填项
    - 'page':                  分页编号，分页为0或者空时，返回第一页数据
    - 'size':                  每页数据条数，为0或空时，默认返回12条数据
    - 'token'：                token
Response:
    - 'status'：0->OK
                1->无效的成绩标签
                2->班级不存在
                11->token is invalid
                12->token is timeout
                13->Illegal interface calls, not power use interface
    - 'resultsTagId'：   成绩标签id
    - 'resultsTagName':  成绩标签名称 
    - 'cid':             班级id
    - 'className':       班级名字
    - 'page':            页码
    - 'size':            每页显示条数
    - 'count':           数据总数
    - 'studentlist':     学生总成绩列表 
    - 'studentId'：      学生id
    - 'studentName'：    学生名字
    - 'number'：         学生学号
    - 'totalPoints'：    学生成绩总分
    - 'ranking'：        学生班级成绩排名
```

> **返回结果示例：**

``` json
{
    "status": 0,
    "data": {
        "resultsTagName":"期中考试", 
        "resultsTagId":"2",
        "cid":"12",
        "className":"高一三班",
        "page":"2",
        "size":"12",
        "count":"23",
        "studentlist":[
            {
                "studentId":"1",
                "studentName":"张三三",
                "number":"01021200",       
                "totalPoints":"603",         
                "ranking":"2"
            },
            {
                "studentId":"2",
                "studentName":"张四三",
                "number":"01021201",       
                "totalPoints":"601",         
                "ranking":"3"
            }
        ]
    }
}
```
####13.2.4 班级学生成绩搜索接口
> 需要使用Token验证查询者身份

``` json
Url:        /qxy/results/search?resultsTagId=[resultsTagId]&studentId=[studentId]&number=[number]&token=[token]
Method:     GET
Header:     Content-type:application/json
Parameter:
    - 'resultsTagId'：         成绩标签id--必填项
    - 'studentId'：            学生id--选填（id学号二选一）
    - 'number'：               学生学号--选填（id学号二选一）
    - 'token'：                token
Response:
    - 'status'：0->OK
                1->无效的学生id
                2->无效的学生学号
                11->token is invalid
                12->token is timeout
                13->Illegal interface calls, not power use interface
    - 'studentlist':     学生总成绩列表 
    - 'studentId'：      学生id
    - 'studentName'：    学生名字
    - 'number'：         学生学号
    - 'totalPoints'：    学生成绩总分
    - 'ranking'：        学生班级成绩排名
```

> **返回结果示例：**

``` json
{
    "status": 0,
    "data": {
        "resultsTagName":"期中考试", 
        "resultsTagId":"2",
        "cid":"12",
        "className":"高一三班",
        "studentlist":{
	        "studentId":"1",
	        "studentName":"张三三",
	        "number":"01021200",       
	        "totalPoints":"603",         
	        "ranking":"2"
        }
    }
}
```

####13.2.5 班级学生成绩删除接口
> 需要使用Token验证查询者身份
> 用于删除班级学生的某次考试的总成绩

``` json
Url:        /qxy/results/student?token=[token]
Method:     DELETE
Header:     Content-type:application/json
Parameter:
    - 'resultsTagId'：         成绩标签id--必填项
    - 'studentId'：            学生id--必填项
    - 'token'：                token

示例：
{
	"studentId":"1",
    "resultsTagId":"2"
}

Response:
    - 'status'：0->OK
                1->无效的学生
                2->无效的成绩标签
                11->token is invalid
                12->token is timeout
                13->Illegal interface calls, not power use interface
```

> **返回结果示例：**

``` json
{
    "status": 0,
    "data": {
        "info":"ok"
    }
}
```
####13.2.6 学生科目成绩列表查询接口
> 需要使用Token验证查询者身份

``` json
Url:        /qxy/results/student/course?resultsTagId=[resultsTagId]&studentId=[studentId]&token=[token]
Method:     GET
Header:     Content-type:application/json
Parameter:
    - 'resultsTagId'：         成绩标签id--必填项
    - 'studentId'：            学生id--必填项
    - 'token'：                token
Response:
    - 'status'：0->OK
                1->无效的学生
                2->无效的成绩标签
                11->token is invalid
                12->token is timeout
                13->Illegal interface calls, not power use interface    
    - 'resultsTagId'：   成绩标签id
    - 'resultsTagName':  成绩标签名称 
    - 'cid':             班级id
    - 'className':       班级名字
    - 'studentId'：      学生id
    - 'studentName'：    学生名字
    - 'number'：         学生学号
    - 'totalPoints'：    学生成绩总分
    - 'courseScoreList': 学生科目成绩列表 
    - 'courseId'：       科目id
    - 'courseName'：     科目名字
    - 'courseScore'：    科目分数
    - 'courseRanking'：  科目排名
    - 'updateTime'：     更新时间
```

> **返回结果示例：**

``` json
{
    "status": 0,
    "data": {
        "resultsTagName":"期中考试", 
        "resultsTagId":"2",
        "cid":"12",
        "className":"高一三班",
        "studentId":"1",
        "studentName":"张三三",
        "number":"01021200",       
        "totalPoints":"603",     
        "courseScoreList":[
	        {
		        "courseId":"1",
		        "courseName":"语文",
		        "courseScore":"89",
		        "courseRanking":"5",
		        "updateTime":"2016-8-9 00:00:00"
	        },
	        {
		        "courseId":"2",
		        "courseName":"数学",
		        "courseScore":"89",
		        "courseRanking":"5",
		        "updateTime":"2016-8-9 00:00:00"
	        }
        ]
    }
}
```

####13.2.7 学生科目成绩新增接口
> 需要使用Token验证查询者身份

``` json
Url:        /qxy/results/student/course?token=[token]
Method:     POST
Header:     Content-type:application/json
Parameter:
    - 'resultsTagId'：         成绩标签id--必填项
    - 'studentId'：            学生id--必填项
    - 'courseId'：             科目id--必填项
    - 'score'：                学生科目分数--必填项
    - 'token'：                token

示例：
{
	"studentId":"1",
    "resultsTagId":"2",
	"courseId":"1",
    "score":"80"
}

Response:
    - 'status'：0->OK
                1->无效的学生
                2->无效的成绩标签
                3->无效的科目
                11->token is invalid
                12->token is timeout
                13->Illegal interface calls, not power use interface
```

> **返回结果示例：**

``` json
{
    "status": 0,
    "data": {
        "info":"ok"
    }
}
```

####13.2.8 学生科目成绩修改接口
> 需要使用Token验证查询者身份

``` json
Url:        /qxy/results/student/course?token=[token]
Method:     PUT
Header:     Content-type:application/json
Parameter:
    - 'resultsId'：            成绩id--必填项
    - 'score'：                学生科目分数--必填项
    - 'token'：                token

示例：
{
	"resultsId":"1",
    "score":"80"
}

Response:
    - 'status'：0->OK
                1->无效的成绩ID
                11->token is invalid
                12->token is timeout
                13->Illegal interface calls, not power use interface
```

> **返回结果示例：**

``` json
{
    "status": 0,
    "data": {
        "info":"ok"
    }
}
```


####13.2.9 学生科目成绩删除接口
> 需要使用Token验证查询者身份

``` json
Url:        /qxy/results/student/course?token=[token]
Method:     DELETE
Header:     Content-type:application/json
Parameter:
    - 'resultsId'：            成绩id--必填项
    - 'token'：                token

示例：
{
	"resultsId":"1"
}

Response:
    - 'status'：0->OK
                1->无效的成绩ID
                11->token is invalid
                12->token is timeout
                13->Illegal interface calls, not power use interface
```

> **返回结果示例：**

``` json
{
    "status": 0,
    "data": {
        "info":"ok"
    }
}
```


####13.2.10 班级学生成绩导入接口
> 需要使用Token验证查询者身份
> 先通过2.1.6 资源上传接口上传excel返回资源地址，再调用这个接口导入班级学生成绩

``` json
Url:        /qxy/import/results/course?token=[token]
Method:     POST
Header:     Content-type:application/json
Parameter:
    - 'resultsTagId'：            成绩标签id--必填项
    - 'cid'：                     班级id--必填项
    - 'courseId'：                科目id--必填项
    - 'excel'：                   excel地址--必填项
    - 'token'：                   token

示例：
{
	"resultsTagId":"1",
	"cid":"1",
	"courseId":"1",
	"excel":"url"
}

Response:
    - 'status'：0->OK
                1->无效的成绩标签ID
                1->无效的班级ID
                1->无效的科目ID
                11->token is invalid
                12->token is timeout
                13->Illegal interface calls, not power use interface
```

> **返回结果示例：**

``` json
{
    "status": 0,
    "data": {
        "info":"ok"
    }
}
```

####13.2.11 考试科目成绩删除接口
> 需要使用Token验证查询者身份
> 用于删除某一科目下某个班级学生的成绩

``` json
Url:        /qxy/results/course?token=[token]
Method:     POST
Header:     Content-type:application/json
Parameter:
    - 'resultsTagId'：            成绩标签id--必填项
    - 'cid'：                     班级id--必填项
    - 'courseId'：                科目id--必填项
    - 'token'：                   token

示例：
{
	"resultsTagId":"1",
	"cid":"1",
	"courseId":"1"
}

Response:
    - 'status'：0->OK
                1->无效的成绩标签ID
                1->无效的班级ID
                1->无效的科目ID
                11->token is invalid
                12->token is timeout
                13->Illegal interface calls, not power use interface
```

> **返回结果示例：**

``` json
{
    "status": 0,
    "data": {
        "info":"ok"
    }
}
```

####13.2.12 班级科目列表查询接口
> 需要使用Token验证查询者身份
> 仅获取所有有效的课程
> status值需要接口根据cid+resultsTagId+courseId联合索引，如果有值则为1，没有值则为0；

``` json
Url:        /qxy/results/class/course?resultsTagId=[resultsTagId]&cid=[cid]&token=[token]
Method:     GET
Header:     Content-type:application/json
Parameter:
    - 'resultsTagId'：            成绩标签id--必填项
    - 'cid'：                     班级id--必填项
    - 'token'：                   token
Response:
    - 'status'：0->OK
                1->无效的成绩标签ID
                1->无效的班级ID
                11->token is invalid
                12->token is timeout
                13->Illegal interface calls, not power use interface
    - 'resultsTagId'：    成绩标签id
    - 'resultsTagName':  成绩标签名称 
    - 'cid':             班级id
    - 'className':       班级名字
    - 'courselist':      科目列表
    - 'courseId':        科目id
    - 'courseName':      科目名字
    - 'status':          班级科目成绩导入状态 0-未导入，1-已导入
```

> **返回结果示例：**

``` json
{
    "status": 0,
    "data": {
        "resultsTagName":"期中考试", 
        "resultsTagId":"2",
        "cid":"12",
        "className":"高一三班",    
        "courseList":[
	        {
		        "courseId":"1",
		        "courseName":"语文",
		        "status":"1"
	        },
	        {
		        "courseId":"2",
		        "courseName":"数学",
		        "status":"0"
	        }
        ]
    }
}
```


####13.2.13 班级科目学生成绩列表查询接口
> 需要使用Token验证查询者身份
> 声明开发测试时前端需要在url上加上test=true参数，标示为测试接口，接口会返回静态数据以提供给前端调试页面使用，前端需要使用测试接口完成数据渲染工作后，等到正式接口开发完成后，才能调用正式接口；

``` json
Url:        /qxy/results/class/course/student?resultsTagId=[resultsTagId]&cid=[cid]&courseId=[courseId]&page=[page]&size=[size]&order=[order]&token=[token]
Method:     GET
Header:     Content-type:application/json
Parameter:
    - 'resultsTagId'：            成绩标签id--必填项
    - 'cid'：                     班级id--必填项
    - 'courseId'：                科目id--必填项
    - 'page':                    分页编号，分页为0或者空时，返回第一页数据
    - 'size':                    每页数据条数，为0或空时，默认返回12条数据
    - 'order':                   结果排序（按照分值排序）：为空或=0-正序排列，1-倒叙排列
    - 'token'：                  token
Response:
    - 'status'：0->OK
                1->无效的成绩标签ID
                1->无效的班级ID
                11->token is invalid
                12->token is timeout
                13->Illegal interface calls, not power use interface
    - 'resultsTagId'：    成绩标签id
    - 'resultsTagName':  成绩标签名称 
    - 'cid':             班级id
    - 'className':       班级名字
    - 'courselist':      科目列表
    - 'courseId':        科目id
    - 'courseName':      科目名字
    - 'status':          班级科目成绩导入状态 0-未导入，1-已导入
```

> **返回结果示例：**

``` json
{
    "status": 0,
    "data": {
        "resultsTagName":"期中考试", 
        "resultsTagId":"2",
        "cid":"12",
        "className":"高一三班",  
        "courseId":"1",
        "courseName":"语文",
        "page":"2",
        "size":"12",
        "count":"20",  
        "studentList":[
	        {
		        "studentId":"1",
		        "studentName":"张三",
		        "number":"100000",
		        "courseScore":"100",
		        "courseRanking":"1"
	        },
	        {
		        "studentId":"2",
		        "studentName":"张三三",
		        "number":"100001",
		        "courseScore":"99",
		        "courseRanking":"2"
	        }
        ]
    }
}
```